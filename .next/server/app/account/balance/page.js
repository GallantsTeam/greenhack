(()=>{var e={};e.id=4165,e.ids=[4165],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},3662:(e,t,r)=>{"use strict";r.d(t,{A:()=>a});let a=(0,r(82614).A)("CircleCheckBig",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]])},9095:(e,t,r)=>{Promise.resolve().then(r.bind(r,89135))},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},19121:e=>{"use strict";e.exports=require("next/dist/server/app-render/action-async-storage.external.js")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},33873:e=>{"use strict";e.exports=require("path")},44493:(e,t,r)=>{"use strict";r.d(t,{BT:()=>d,Wu:()=>c,ZB:()=>l,Zp:()=>o,aR:()=>n,wL:()=>m});var a=r(60687),s=r(43210),i=r(4780);let o=s.forwardRef(({className:e,...t},r)=>(0,a.jsx)("div",{ref:r,className:(0,i.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",e),...t}));o.displayName="Card";let n=s.forwardRef(({className:e,...t},r)=>(0,a.jsx)("div",{ref:r,className:(0,i.cn)("flex flex-col space-y-1.5 p-6",e),...t}));n.displayName="CardHeader";let l=s.forwardRef(({className:e,...t},r)=>(0,a.jsx)("h3",{ref:r,className:(0,i.cn)("text-xl font-normal uppercase tracking-wider leading-none",e),...t}));l.displayName="CardTitle";let d=s.forwardRef(({className:e,...t},r)=>(0,a.jsx)("p",{ref:r,className:(0,i.cn)("text-sm text-muted-foreground",e),...t}));d.displayName="CardDescription";let c=s.forwardRef(({className:e,...t},r)=>(0,a.jsx)("div",{ref:r,className:(0,i.cn)("p-6 pt-0",e),...t}));c.displayName="CardContent";let m=s.forwardRef(({className:e,...t},r)=>(0,a.jsx)("div",{ref:r,className:(0,i.cn)("flex items-center p-6 pt-0",e),...t}));m.displayName="CardFooter"},48214:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>N});var a=r(60687),s=r(43210),i=r(29523),o=r(44493),n=r(89667),l=r(80013),d=r(11516);let c=(0,r(82614).A)("Banknote",[["rect",{width:"20",height:"12",x:"2",y:"6",rx:"2",key:"9lu3g6"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}],["path",{d:"M6 12h.01M18 12h.01",key:"113zkx"}]]);var m=r(77368),p=r(29596),u=r(76976),x=r(3662),h=r(63213),f=r(29867),y=r(4780),v=r(27605),j=r(63442),w=r(45880);let g=w.Ik({amount:w.au.number().min(1,"Сумма должна быть не менее 1 GH.").max(1e5,"Максимальная сумма 100 000 GH.")}),b=w.Ik({promoCode:w.Yj().min(1,"Введите промокод.")});function N(){var e;let{currentUser:t,fetchUserDetails:r,loading:w}=(0,h.A)(),[N,_]=(0,s.useState)(!1),[k,C]=(0,s.useState)(!1),[A,P]=(0,s.useState)(!1),[S,M]=(0,s.useState)(!1),[R,q]=(0,s.useState)(null),[G,T]=(0,s.useState)(!0),{toast:E}=(0,f.dj)(),Z=(0,v.mN)({resolver:(0,j.u)(g),defaultValues:{amount:void 0}}),H=(0,v.mN)({resolver:(0,j.u)(b),defaultValues:{promoCode:""}}),L=(0,s.useCallback)(async()=>{if(t?.id){_(!0);try{await r(t.id),E({title:"Баланс обновлен"})}catch(e){E({title:"Ошибка",description:"Не удалось обновить баланс.",variant:"destructive"})}finally{_(!1)}}},[t?.id,r,E]),z=async e=>{if(!t||G)return;C(!0),P(!1);let a=R?.is_test_mode_active?"/api/payment/request":"/api/payment/create-yoomoney-payment";try{let s=await fetch(a,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:t.id,amountGh:e.amount})}),i=await s.json();if(!s.ok)throw Error(i.message||"Не удалось обработать запрос на пополнение.");R?.is_test_mode_active?(E({title:"Заявка создана",description:"Ваша заявка на пополнение отправлена. Ожидайте подтверждения администратором."}),P(!0)):(E({title:"Создание платежа",description:"Перенаправление на страницу оплаты..."}),console.log("YooMoney Confirmation URL:",i.confirmation_url),i.confirmation_url?window.location.href=i.confirmation_url:P(!0)),Z.reset(),t?.id&&r(t.id)}catch(e){E({title:"Ошибка пополнения",description:e.message,variant:"destructive"})}finally{C(!1)}},B=async e=>{if(!t){E({title:"Ошибка",description:"Для активации промокода необходимо авторизоваться.",variant:"destructive"});return}M(!0);try{let a=await fetch("/api/promocode/apply",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:t.id,code:e.promoCode})}),s=await a.json();if(!a.ok)throw Error(s.message||"Не удалось применить промокод");E({title:"Успех!",description:s.message}),t?.id&&await r(t.id),H.reset()}catch(e){E({title:"Ошибка промокода",description:e.message,variant:"destructive"})}finally{M(!1)}};return w||G?(0,a.jsxs)("div",{className:"flex justify-center items-center min-h-[calc(100vh-var(--header-height)-var(--footer-height))]",children:[(0,a.jsx)(d.A,{className:"h-8 w-8 animate-spin text-primary mr-2"})," Загрузка данных..."]}):(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center mb-4",children:[(0,a.jsx)("h1",{className:"text-3xl font-bold text-primary tracking-tight",children:"Управление Балансом"}),(0,a.jsx)("div",{className:"mt-2 md:mt-0",children:(0,a.jsx)(o.Zp,{className:"shadow-sm bg-card/50 border-border",children:(0,a.jsxs)(o.Wu,{className:"p-3 flex items-center",children:[(0,a.jsx)(c,{className:"mr-3 h-6 w-6 text-primary"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:"Текущий баланс:"}),(0,a.jsxs)("p",{className:"text-2xl font-bold text-foreground",children:["number"==typeof(e=t?.balance)?e.toFixed(2):"0.00"," ",(0,a.jsx)("span",{className:"text-gradient-gh",children:"GH"})]})]}),(0,a.jsx)(i.$,{variant:"ghost",size:"icon",onClick:L,disabled:N,className:"ml-3 h-7 w-7 p-0 text-primary hover:text-primary/80",children:(0,a.jsx)(m.A,{className:(0,y.cn)("h-4 w-4",N&&"animate-spin")})})]})})})]}),(0,a.jsxs)("div",{className:"grid md:grid-cols-2 gap-6 items-start",children:[(0,a.jsxs)(o.Zp,{className:"shadow-lg md:sticky md:top-24",children:[" ",(0,a.jsx)(o.aR,{children:(0,a.jsxs)(o.ZB,{className:"text-xl text-primary flex items-center",children:[(0,a.jsx)(p.A,{className:"mr-2 h-6 w-6"}),"Пополнить счет"]})}),(0,a.jsxs)(o.Wu,{className:"space-y-4",children:[(0,a.jsxs)("form",{onSubmit:Z.handleSubmit(z),className:"space-y-3",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)(l.Label,{htmlFor:"amount",className:"text-foreground",children:"Сумма (GH)"}),(0,a.jsx)(n.p,{type:"number",id:"amount",placeholder:"Например, 500",className:"mt-1",...Z.register("amount"),disabled:k||A||G}),Z.formState.errors.amount&&(0,a.jsx)("p",{className:"text-sm text-destructive mt-1",children:Z.formState.errors.amount.message})]}),(0,a.jsxs)(i.$,{type:"submit",className:"w-full bg-primary hover:bg-primary/90 text-primary-foreground",disabled:k||A||G,children:[G?(0,a.jsx)(d.A,{className:"mr-2 h-4 w-4 animate-spin"}):k?(0,a.jsx)(d.A,{className:"mr-2 h-4 w-4 animate-spin"}):null,G?"Загрузка настроек...":k?"Обработка...":A?R?.is_test_mode_active?"Заявка ожидает":"Ожидание оплаты":R?.is_test_mode_active?"Создать заявку":"Перейти к оплате"]})]}),A&&(0,a.jsx)("p",{className:"text-xs text-center text-yellow-500 bg-yellow-500/10 p-2 rounded-md",children:R?.is_test_mode_active?"Ваша заявка создана и ожидает подтверждения администратором. Баланс обновится после одобрения.":"Для завершения пополнения, пожалуйста, следуйте инструкциям на странице оплаты."}),!R?.is_test_mode_active&&!A&&(0,a.jsx)("p",{className:"text-xs text-center text-muted-foreground",children:"Оплата будет производиться через YooMoney Касса."}),R?.is_test_mode_active&&!A&&(0,a.jsx)("p",{className:"text-xs text-center text-muted-foreground",children:"Тестовый режим: пополнение через заявку администратору."})]})]}),(0,a.jsxs)(o.Zp,{className:"shadow-lg",children:[(0,a.jsx)(o.aR,{children:(0,a.jsxs)(o.ZB,{className:"text-xl text-primary flex items-center",children:[(0,a.jsx)(u.A,{className:"mr-2 h-6 w-6"}),"Активация кода"]})}),(0,a.jsxs)(o.Wu,{className:"space-y-4",children:[(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:"Если вы получили код пополнения от администрации или уникальный промокод, введите его здесь для активации и зачисления средств или получения товара."}),(0,a.jsxs)("form",{onSubmit:H.handleSubmit(B),className:"space-y-3",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)(l.Label,{htmlFor:"promoCode",className:"text-foreground",children:"Код активации / Промокод"}),(0,a.jsx)(n.p,{type:"text",id:"promoCode",placeholder:"TEST-CODE-123",className:"mt-1 uppercase",...H.register("promoCode"),disabled:S}),H.formState.errors.promoCode&&(0,a.jsx)("p",{className:"text-sm text-destructive mt-1",children:H.formState.errors.promoCode.message})]}),(0,a.jsxs)(i.$,{type:"submit",className:"w-full bg-primary hover:bg-primary/90 text-primary-foreground",disabled:S,children:[S?(0,a.jsx)(d.A,{className:"mr-2 h-4 w-4 animate-spin"}):(0,a.jsx)(x.A,{className:"mr-2 h-4 w-4"}),"Активировать"]})]})]})]})]})]})}},48415:(e,t,r)=>{Promise.resolve().then(r.bind(r,48214))},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},76976:(e,t,r)=>{"use strict";r.d(t,{A:()=>a});let a=(0,r(82614).A)("Ticket",[["path",{d:"M2 9a3 3 0 0 1 0 6v2a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-2a3 3 0 0 1 0-6V7a2 2 0 0 0-2-2H4a2 2 0 0 0-2 2Z",key:"qn84l0"}],["path",{d:"M13 5v2",key:"dyzc3o"}],["path",{d:"M13 17v2",key:"1ont0d"}],["path",{d:"M13 11v2",key:"1wjjxi"}]])},77368:(e,t,r)=>{"use strict";r.d(t,{A:()=>a});let a=(0,r(82614).A)("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]])},79551:e=>{"use strict";e.exports=require("url")},89135:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>a});let a=(0,r(12907).registerClientReference)(function(){throw Error("Attempted to call the default export of \"/var/www/html/src/app/account/balance/page.tsx\" from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"/var/www/html/src/app/account/balance/page.tsx","default")},89189:(e,t,r)=>{"use strict";r.r(t),r.d(t,{GlobalError:()=>o.a,__next_app__:()=>m,pages:()=>c,routeModule:()=>p,tree:()=>d});var a=r(65239),s=r(48088),i=r(88170),o=r.n(i),n=r(30893),l={};for(let e in n)0>["default","tree","pages","GlobalError","__next_app__","routeModule"].indexOf(e)&&(l[e]=()=>n[e]);r.d(t,l);let d={children:["",{children:["account",{children:["balance",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(r.bind(r,89135)),"/var/www/html/src/app/account/balance/page.tsx"]}]},{}]},{layout:[()=>Promise.resolve().then(r.bind(r,96779)),"/var/www/html/src/app/account/layout.tsx"],metadata:{icon:[async e=>(await Promise.resolve().then(r.bind(r,70440))).default(e)],apple:[],openGraph:[],twitter:[],manifest:void 0}}]},{layout:[()=>Promise.resolve().then(r.bind(r,94431)),"/var/www/html/src/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(r.t.bind(r,57398,23)),"next/dist/client/components/not-found-error"],forbidden:[()=>Promise.resolve().then(r.t.bind(r,89999,23)),"next/dist/client/components/forbidden-error"],unauthorized:[()=>Promise.resolve().then(r.t.bind(r,65284,23)),"next/dist/client/components/unauthorized-error"],metadata:{icon:[async e=>(await Promise.resolve().then(r.bind(r,70440))).default(e)],apple:[],openGraph:[],twitter:[],manifest:void 0}}]}.children,c=["/var/www/html/src/app/account/balance/page.tsx"],m={require:r,loadChunk:()=>Promise.resolve()},p=new a.AppPageRouteModule({definition:{kind:s.RouteKind.APP_PAGE,page:"/account/balance/page",pathname:"/account/balance",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:d}})}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[4447,6724,377,1658,8030,9989,4519,1208],()=>r(89189));module.exports=a})();