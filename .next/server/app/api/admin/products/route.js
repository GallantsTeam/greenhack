(()=>{var e={};e.id=8898,e.ids=[8898],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},11204:(e,t,r)=>{"use strict";r.r(t),r.d(t,{patchFetch:()=>f,routeModule:()=>p,serverHooks:()=>g,workAsyncStorage:()=>m,workUnitAsyncStorage:()=>d});var i={};r.r(i),r.d(i,{GET:()=>u,POST:()=>c,dynamic:()=>n});var a=r(96559),s=r(48088),_=r(37719),o=r(32190),l=r(75365);let n="force-dynamic";async function u(e){try{let e=await (0,l.P)(`SELECT 
         p.id, p.name, p.slug, p.game_slug, p.image_url, 
         p.status, p.status_text, 
         p.short_description, p.long_description, p.data_ai_hint,
         p.mode, p.gallery_image_urls,
         p.functions_aim_title, p.functions_aim, p.functions_aim_description,
         p.functions_esp_title, p.functions_wallhack, p.functions_esp_description,
         p.functions_misc_title, p.functions_misc, p.functions_misc_description,
         p.system_os, p.system_build, p.system_gpu, p.system_cpu,
         p.price_text,
         p.retrieval_modal_intro_text,
         p.retrieval_modal_antivirus_text,
         p.retrieval_modal_antivirus_link_text,
         p.retrieval_modal_antivirus_link_url,
         p.retrieval_modal_launcher_text,
         p.retrieval_modal_launcher_link_text,
         p.retrieval_modal_launcher_link_url,
         p.retrieval_modal_key_paste_text,
         p.retrieval_modal_support_text,
         p.retrieval_modal_support_link_text,
         p.retrieval_modal_support_link_url,
         p.retrieval_modal_how_to_run_link,
         p.created_at, p.updated_at,
         (SELECT MIN(ppo.price_rub) FROM product_pricing_options ppo WHERE ppo.product_id = p.id) as min_price_rub_calculated,
         (SELECT MIN(ppo.price_gh) FROM product_pricing_options ppo WHERE ppo.product_id = p.id) as min_price_gh_calculated,
         COALESCE(g.name, p.game_slug) as gameName,
         g.logo_url as gameLogoUrl,
         g.platform as gamePlatform
       FROM products p
       LEFT JOIN games g ON p.game_slug = g.slug 
       ORDER BY p.created_at DESC, p.name ASC`);if(!Array.isArray(e))return console.error("API Admin Products GET Error: Expected an array from database query, received:",e),o.NextResponse.json({message:"Failed to retrieve products: unexpected database response format."},{status:500});let t=e.map(e=>({id:e.id,name:e.name,slug:e.slug,game_slug:e.game_slug,image_url:e.image_url?e.image_url.trim():null,imageUrl:(e.image_url||`https://placehold.co/300x350.png?text=${encodeURIComponent(e.name)}`).trim(),status:e.status||"unknown",status_text:e.status_text,price:parseFloat(e.min_price_rub_calculated||"0"),min_price_rub:e.min_price_rub_calculated?parseFloat(e.min_price_rub_calculated):void 0,min_price_gh:e.min_price_gh_calculated?parseFloat(e.min_price_gh_calculated):void 0,price_text:e.price_text,short_description:e.short_description,long_description:e.long_description,data_ai_hint:e.data_ai_hint||`${e.name.toLowerCase()} product`,mode:e.mode,gallery_image_urls:e.gallery_image_urls?e.gallery_image_urls.split(",").map(e=>e.trim()).filter(Boolean):[],functions_aim_title:e.functions_aim_title||"Aimbot Функции",functions_aim:e.functions_aim?e.functions_aim.split(",").map(e=>e.trim()).filter(Boolean):[],functions_aim_description:e.functions_aim_description,functions_esp_title:e.functions_esp_title||"ESP/Wallhack Функции",functions_wallhack:e.functions_wallhack?e.functions_wallhack.split(",").map(e=>e.trim()).filter(Boolean):[],functions_esp_description:e.functions_esp_description,functions_misc_title:e.functions_misc_title||"Прочие Функции",functions_misc:e.functions_misc?e.functions_misc.split(",").map(e=>e.trim()).filter(Boolean):[],functions_misc_description:e.functions_misc_description,system_os:e.system_os,system_build:e.system_build,system_gpu:e.system_gpu,system_cpu:e.system_cpu,retrieval_modal_intro_text:e.retrieval_modal_intro_text,retrieval_modal_antivirus_text:e.retrieval_modal_antivirus_text,retrieval_modal_antivirus_link_text:e.retrieval_modal_antivirus_link_text,retrieval_modal_antivirus_link_url:e.retrieval_modal_antivirus_link_url,retrieval_modal_launcher_text:e.retrieval_modal_launcher_text,retrieval_modal_launcher_link_text:e.retrieval_modal_launcher_link_text,retrieval_modal_launcher_link_url:e.retrieval_modal_launcher_link_url,retrieval_modal_key_paste_text:e.retrieval_modal_key_paste_text,retrieval_modal_support_text:e.retrieval_modal_support_text,retrieval_modal_support_link_text:e.retrieval_modal_support_link_text,retrieval_modal_support_link_url:e.retrieval_modal_support_link_url,retrieval_modal_how_to_run_link:e.retrieval_modal_how_to_run_link,created_at:e.created_at,updated_at:e.updated_at,gameName:e.gameName,gameLogoUrl:e.gameLogoUrl?e.gameLogoUrl.trim():null,gamePlatform:e.gamePlatform}));return o.NextResponse.json(t,{status:200})}catch(e){return console.error("API Admin Products GET Error:",e),o.NextResponse.json({message:`Internal Server Error: ${e.message}`,error_details:e.toString()},{status:500})}}async function c(e){let t;try{let{id:r,name:i,slug:a,game_slug:s,status:_,pricing_options:n,...u}=t=await e.json();if(!r||!i||!a||!s||!_)return o.NextResponse.json({message:"ID, Name, Slug, Game Slug, and Status are required."},{status:400});if(r!==a)return o.NextResponse.json({message:"Product ID and Slug must match for new products."},{status:400});let c=await (0,l.P)("SELECT id FROM products WHERE id = ? OR slug = ?",[r,a]);if(Array.isArray(c)&&c.length>0)return o.NextResponse.json({message:"Product with this ID or Slug already exists."},{status:409});let p={id:r,name:i,slug:a,game_slug:s,status:_,created_at:new Date,updated_at:new Date,functions_aim_title:u.functions_aim_title||"Aimbot Функции",functions_esp_title:u.functions_esp_title||"ESP/Wallhack Функции",functions_misc_title:u.functions_misc_title||"Прочие Функции"};["image_url","status_text","short_description","long_description","data_ai_hint","mode","gallery_image_urls","functions_aim","functions_aim_description","functions_wallhack","functions_esp_description","functions_misc","functions_misc_description","system_os","system_build","system_gpu","system_cpu","price_text","retrieval_modal_intro_text","retrieval_modal_antivirus_text","retrieval_modal_antivirus_link_text","retrieval_modal_antivirus_link_url","retrieval_modal_launcher_text","retrieval_modal_launcher_link_text","retrieval_modal_launcher_link_url","retrieval_modal_key_paste_text","retrieval_modal_support_text","retrieval_modal_support_link_text","retrieval_modal_support_link_url","retrieval_modal_how_to_run_link"].forEach(e=>{void 0!==u[e]&&("gallery_image_urls"===e&&Array.isArray(u[e])?p[e]=u[e].join(","):p[e]=""===u[e]?null:u[e])});let m=Object.keys(p),d=m.map(()=>"?").join(", "),g=Object.values(p),f=`INSERT INTO products (${m.join(", ")}) VALUES (${d})`,v=await (0,l.P)(f,g),x=0;if(v&&"affectedRows"in v&&!Array.isArray(v)?x=v.affectedRows:Array.isArray(v)&&v.length>0&&"affectedRows"in v[0]&&(x=v[0].affectedRows),!(x>0))return console.error("Product creation in DB failed, no affected rows:",v),o.NextResponse.json({message:"Не удалось создать товар в базе данных."},{status:500});{if(n&&Array.isArray(n)&&n.length>0)for(let e of n){let{duration_days:t,price_rub:i,price_gh:a,payment_link:s,mode_label:_}=e;await (0,l.P)("INSERT INTO product_pricing_options (product_id, duration_days, price_rub, price_gh, payment_link, mode_label) VALUES (?, ?, ?, ?, ?, ?)",[r,t,i,a,s||null,_||null])}let e=await (0,l.P)(`SELECT 
            p.*,
            (SELECT MIN(ppo_in.price_rub) FROM product_pricing_options ppo_in WHERE ppo_in.product_id = p.id) as min_price_rub_calculated,
            (SELECT MIN(ppo_in.price_gh) FROM product_pricing_options ppo_in WHERE ppo_in.product_id = p.id) as min_price_gh_calculated,
            COALESCE(g.name, p.game_slug) as gameName,
            g.logo_url as gameLogoUrl,
            g.platform as gamePlatform
         FROM products p
         LEFT JOIN games g ON p.game_slug = g.slug
         WHERE p.id = ?`,[r]);if(!Array.isArray(e)||0===e.length)return console.error("Failed to fetch newly created product from DB:",r),o.NextResponse.json({message:"Товар создан, но не удалось получить его обновленные данные."},{status:500});let t=e[0],i={id:t.id,name:t.name,slug:t.slug,game_slug:t.game_slug,image_url:t.image_url?t.image_url.trim():null,imageUrl:(t.image_url||`https://placehold.co/300x350.png?text=${encodeURIComponent(t.name)}`).trim(),status:t.status||"unknown",status_text:t.status_text,price:parseFloat(t.min_price_rub_calculated||"0"),min_price_rub:t.min_price_rub_calculated?parseFloat(t.min_price_rub_calculated):void 0,min_price_gh:t.min_price_gh_calculated?parseFloat(t.min_price_gh_calculated):void 0,price_text:t.price_text,short_description:t.short_description,long_description:t.long_description,data_ai_hint:t.data_ai_hint||`${t.name.toLowerCase()} product`,mode:t.mode,gallery_image_urls:t.gallery_image_urls?t.gallery_image_urls.split(",").map(e=>e.trim()).filter(Boolean):[],functions_aim_title:t.functions_aim_title,functions_aim:t.functions_aim?t.functions_aim.split(",").map(e=>e.trim()).filter(Boolean):[],functions_aim_description:t.functions_aim_description,functions_esp_title:t.functions_esp_title,functions_wallhack:t.functions_wallhack?t.functions_wallhack.split(",").map(e=>e.trim()).filter(Boolean):[],functions_esp_description:t.functions_esp_description,functions_misc_title:t.functions_misc_title,functions_misc:t.functions_misc?t.functions_misc.split(",").map(e=>e.trim()).filter(Boolean):[],functions_misc_description:t.functions_misc_description,system_os:t.system_os,system_build:t.system_build,system_gpu:t.system_gpu,system_cpu:t.system_cpu,pricing_options:[],retrieval_modal_intro_text:t.retrieval_modal_intro_text,retrieval_modal_antivirus_text:t.retrieval_modal_antivirus_text,retrieval_modal_antivirus_link_text:t.retrieval_modal_antivirus_link_text,retrieval_modal_antivirus_link_url:t.retrieval_modal_antivirus_link_url,retrieval_modal_launcher_text:t.retrieval_modal_launcher_text,retrieval_modal_launcher_link_text:t.retrieval_modal_launcher_link_text,retrieval_modal_launcher_link_url:t.retrieval_modal_launcher_link_url,retrieval_modal_key_paste_text:t.retrieval_modal_key_paste_text,retrieval_modal_support_text:t.retrieval_modal_support_text,retrieval_modal_support_link_text:t.retrieval_modal_support_link_text,retrieval_modal_support_link_url:t.retrieval_modal_support_link_url,retrieval_modal_how_to_run_link:t.retrieval_modal_how_to_run_link,created_at:t.created_at,updated_at:t.updated_at,gameName:t.gameName,gameLogoUrl:t.gameLogoUrl?t.gameLogoUrl.trim():null,gamePlatform:t.gamePlatform};return o.NextResponse.json({message:"Товар успешно создан",product:i},{status:201})}}catch(e){if(console.error("API Admin Products POST Error:",e),console.error("Request body was:",JSON.stringify(t||"Could not parse request body for logging",null,2)),"ER_NO_REFERENCED_ROW_2"===e.code||e.message&&e.message.includes("foreign key constraint fails"))return o.NextResponse.json({message:`Ошибка внешнего ключа: Убедитесь, что указанный 'game_slug' (${t?.game_slug}) существует в таблице категорий (games).`,error_details:e.toString()},{status:400});if("ER_TRUNCATED_WRONG_VALUE_FOR_FIELD"===e.code)return o.NextResponse.json({message:`Ошибка типа данных: Пожалуйста, проверьте правильность введенных числовых значений (например, цена, ID).`,error_details:e.toString()},{status:400});return o.NextResponse.json({message:`Internal Server Error: ${e.message}`,error_details:e.toString()},{status:500})}}let p=new a.AppRouteRouteModule({definition:{kind:s.RouteKind.APP_ROUTE,page:"/api/admin/products/route",pathname:"/api/admin/products",filename:"route",bundlePath:"app/api/admin/products/route"},resolvedPagePath:"/var/www/html/src/app/api/admin/products/route.ts",nextConfigOutput:"",userland:i}),{workAsyncStorage:m,workUnitAsyncStorage:d,serverHooks:g}=p;function f(){return(0,_.patchFetch)({workAsyncStorage:m,workUnitAsyncStorage:d})}},19771:e=>{"use strict";e.exports=require("process")},27910:e=>{"use strict";e.exports=require("stream")},28303:e=>{function t(e){var t=Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}t.keys=()=>[],t.resolve=t,t.id=28303,e.exports=t},28354:e=>{"use strict";e.exports=require("util")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},30035:(e,t,r)=>{"use strict";r.r(t),r.d(t,{"6089447028175c0572b15a7e03e70f832d763fe00d":()=>i.P});var i=r(75365)},34631:e=>{"use strict";e.exports=require("tls")},41204:e=>{"use strict";e.exports=require("string_decoder")},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},55511:e=>{"use strict";e.exports=require("crypto")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},66136:e=>{"use strict";e.exports=require("timers")},74075:e=>{"use strict";e.exports=require("zlib")},75365:(e,t,r)=>{"use strict";r.d(t,{P:()=>l});var i=r(67218);r(79130);var a=r(46101),s=r(17478);let _={host:process.env.DB_HOST,user:process.env.DB_USER,password:process.env.DB_PASSWORD,database:process.env.DB_NAME,connectionLimit:10,namedPlaceholders:!0},o=null;async function l(e,t){let r;let i=function(){if(!o){if(!process.env.DB_HOST||!process.env.DB_USER||!process.env.DB_NAME)throw console.error("Database environment variables DB_HOST, DB_USER, or DB_NAME are not set."),Error("Database environment variables are not fully set. Please check your .env.local file.");try{o=a.createPool(_),console.log("MySQL connection pool created successfully."),o.getConnection().then(e=>{console.log("Successfully connected to database via pool."),e.release()}).catch(e=>{console.error("Failed to get a connection from pool on startup:",e)})}catch(e){throw console.error("Failed to create MySQL connection pool:",e),o=null,Error("Database connection pool could not be created.")}}return o}();try{r=await i.getConnection(),console.log(`Executing SQL: ${e} with params: ${t?JSON.stringify(t):"No params"}`);let[a]=await r.execute(e,t);return a}catch(e){throw console.error("Database query error:",e.message,e.code,e.sqlMessage,e.sql),Error(`Database query failed: ${e.message}`)}finally{r&&r.release()}}(0,s.D)([l]),(0,i.A)(l,"6089447028175c0572b15a7e03e70f832d763fe00d",null)},78335:()=>{},79428:e=>{"use strict";e.exports=require("buffer")},79551:e=>{"use strict";e.exports=require("url")},91645:e=>{"use strict";e.exports=require("net")},94735:e=>{"use strict";e.exports=require("events")},96487:()=>{}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),i=t.X(0,[4447,6724,5482,580],()=>r(11204));module.exports=i})();