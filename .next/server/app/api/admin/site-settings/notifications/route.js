(()=>{var t={};t.id=2626,t.ids=[2626],t.modules={3295:t=>{"use strict";t.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},10846:t=>{"use strict";t.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},19771:t=>{"use strict";t.exports=require("process")},27910:t=>{"use strict";t.exports=require("stream")},28303:t=>{function e(t){var e=Error("Cannot find module '"+t+"'");throw e.code="MODULE_NOT_FOUND",e}e.keys=()=>[],e.resolve=e,e.id=28303,t.exports=e},28354:t=>{"use strict";t.exports=require("util")},29294:t=>{"use strict";t.exports=require("next/dist/server/app-render/work-async-storage.external.js")},30035:(t,e,o)=>{"use strict";o.r(e),o.d(e,{"6089447028175c0572b15a7e03e70f832d763fe00d":()=>n.P});var n=o(75365)},34631:t=>{"use strict";t.exports=require("tls")},41204:t=>{"use strict";t.exports=require("string_decoder")},44870:t=>{"use strict";t.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},55511:t=>{"use strict";t.exports=require("crypto")},63033:t=>{"use strict";t.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},66136:t=>{"use strict";t.exports=require("timers")},67406:(t,e,o)=>{"use strict";o.r(e),o.d(e,{patchFetch:()=>d,routeModule:()=>u,serverHooks:()=>l,workAsyncStorage:()=>f,workUnitAsyncStorage:()=>y});var n={};o.r(n),o.d(n,{GET:()=>c,PUT:()=>p});var r=o(96559),i=o(48088),s=o(37719),a=o(32190),_=o(75365);async function c(t){try{let t=await (0,_.P)("SELECT * FROM site_notification_settings WHERE id = ? LIMIT 1",[1]);if(!Array.isArray(t)||0===t.length)return a.NextResponse.json({id:1,notify_on_registration:!0,notify_on_balance_deposit:!0,notify_on_product_purchase:!0,notify_on_support_reply:!1,notify_on_software_activation:!1,notify_on_license_expiry_soon:!1,notify_on_promotions:!1});let e=t[0],o={id:e.id,notify_on_registration:!!e.notify_on_registration,notify_on_balance_deposit:!!e.notify_on_balance_deposit,notify_on_product_purchase:!!e.notify_on_product_purchase,notify_on_support_reply:!!e.notify_on_support_reply,notify_on_software_activation:!!e.notify_on_software_activation,notify_on_license_expiry_soon:!!e.notify_on_license_expiry_soon,notify_on_promotions:!!e.notify_on_promotions,updated_at:e.updated_at};return a.NextResponse.json(o)}catch(t){if(console.error("API Admin Notification Settings GET Error:",t),"ER_NO_SUCH_TABLE"===t.code)return console.warn("site_notification_settings table does not exist. Returning default settings."),a.NextResponse.json({id:1,notify_on_registration:!0,notify_on_balance_deposit:!0,notify_on_product_purchase:!0,notify_on_support_reply:!1,notify_on_software_activation:!1,notify_on_license_expiry_soon:!1,notify_on_promotions:!1},{status:200});return a.NextResponse.json({message:`Internal Server Error: ${t.message}`},{status:500})}}async function p(t){try{let{notify_on_registration:e,notify_on_balance_deposit:o,notify_on_product_purchase:n,notify_on_support_reply:r,notify_on_software_activation:i,notify_on_license_expiry_soon:s,notify_on_promotions:c}=await t.json(),p=`
      UPDATE site_notification_settings SET
        notify_on_registration = ?, 
        notify_on_balance_deposit = ?, 
        notify_on_product_purchase = ?, 
        notify_on_support_reply = ?, 
        notify_on_software_activation = ?, 
        notify_on_license_expiry_soon = ?, 
        notify_on_promotions = ?,
        updated_at = NOW()
      WHERE id = ?
    `,u=await (0,_.P)(p,[!!e,!!o,!!n,!!r,!!i,!!s,!!c,1]),f=0;if(u&&"affectedRows"in u?f=u.affectedRows:Array.isArray(u)&&u.length>0&&"affectedRows"in u[0]&&(f=u[0].affectedRows),0===f){let t=`
        INSERT INTO site_notification_settings (
            id, notify_on_registration, notify_on_balance_deposit, notify_on_product_purchase, 
            notify_on_support_reply, notify_on_software_activation, notify_on_license_expiry_soon, 
            notify_on_promotions
        ) VALUES (?, ?, ?, ?, ?, ?, ?, ?)
        ON DUPLICATE KEY UPDATE 
            notify_on_registration=VALUES(notify_on_registration), notify_on_balance_deposit=VALUES(notify_on_balance_deposit),
            notify_on_product_purchase=VALUES(notify_on_product_purchase), notify_on_support_reply=VALUES(notify_on_support_reply),
            notify_on_software_activation=VALUES(notify_on_software_activation), notify_on_license_expiry_soon=VALUES(notify_on_license_expiry_soon),
            notify_on_promotions=VALUES(notify_on_promotions), updated_at=NOW()`;await (0,_.P)(t,[1,!!e,!!o,!!n,!!r,!!i,!!s,!!c])}let y=await (0,_.P)("SELECT * FROM site_notification_settings WHERE id = ? LIMIT 1",[1]);if(!Array.isArray(y)||0===y.length)return a.NextResponse.json({message:"Настройки сохранены, но не удалось получить обновленные данные."},{status:500});let l={id:y[0].id,notify_on_registration:!!y[0].notify_on_registration,notify_on_balance_deposit:!!y[0].notify_on_balance_deposit,notify_on_product_purchase:!!y[0].notify_on_product_purchase,notify_on_support_reply:!!y[0].notify_on_support_reply,notify_on_software_activation:!!y[0].notify_on_software_activation,notify_on_license_expiry_soon:!!y[0].notify_on_license_expiry_soon,notify_on_promotions:!!y[0].notify_on_promotions,updated_at:y[0].updated_at};return a.NextResponse.json({message:"Настройки уведомлений успешно обновлены.",settings:l},{status:200})}catch(t){return console.error("API Admin Notification Settings PUT Error:",t),a.NextResponse.json({message:`Internal Server Error: ${t.message}`},{status:500})}}let u=new r.AppRouteRouteModule({definition:{kind:i.RouteKind.APP_ROUTE,page:"/api/admin/site-settings/notifications/route",pathname:"/api/admin/site-settings/notifications",filename:"route",bundlePath:"app/api/admin/site-settings/notifications/route"},resolvedPagePath:"/var/www/html/src/app/api/admin/site-settings/notifications/route.ts",nextConfigOutput:"",userland:n}),{workAsyncStorage:f,workUnitAsyncStorage:y,serverHooks:l}=u;function d(){return(0,s.patchFetch)({workAsyncStorage:f,workUnitAsyncStorage:y})}},74075:t=>{"use strict";t.exports=require("zlib")},75365:(t,e,o)=>{"use strict";o.d(e,{P:()=>_});var n=o(67218);o(79130);var r=o(46101),i=o(17478);let s={host:process.env.DB_HOST,user:process.env.DB_USER,password:process.env.DB_PASSWORD,database:process.env.DB_NAME,connectionLimit:10,namedPlaceholders:!0},a=null;async function _(t,e){let o;let n=function(){if(!a){if(!process.env.DB_HOST||!process.env.DB_USER||!process.env.DB_NAME)throw console.error("Database environment variables DB_HOST, DB_USER, or DB_NAME are not set."),Error("Database environment variables are not fully set. Please check your .env.local file.");try{a=r.createPool(s),console.log("MySQL connection pool created successfully."),a.getConnection().then(t=>{console.log("Successfully connected to database via pool."),t.release()}).catch(t=>{console.error("Failed to get a connection from pool on startup:",t)})}catch(t){throw console.error("Failed to create MySQL connection pool:",t),a=null,Error("Database connection pool could not be created.")}}return a}();try{o=await n.getConnection(),console.log(`Executing SQL: ${t} with params: ${e?JSON.stringify(e):"No params"}`);let[r]=await o.execute(t,e);return r}catch(t){throw console.error("Database query error:",t.message,t.code,t.sqlMessage,t.sql),Error(`Database query failed: ${t.message}`)}finally{o&&o.release()}}(0,i.D)([_]),(0,n.A)(_,"6089447028175c0572b15a7e03e70f832d763fe00d",null)},78335:()=>{},79428:t=>{"use strict";t.exports=require("buffer")},79551:t=>{"use strict";t.exports=require("url")},91645:t=>{"use strict";t.exports=require("net")},94735:t=>{"use strict";t.exports=require("events")},96487:()=>{}};var e=require("../../../../../webpack-runtime.js");e.C(t);var o=t=>e(e.s=t),n=e.X(0,[4447,6724,5482,580],()=>o(67406));module.exports=n})();