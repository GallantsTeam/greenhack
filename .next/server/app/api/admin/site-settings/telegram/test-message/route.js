"use strict";(()=>{var e={};e.id=7524,e.ids=[7524],e.modules={3295:e=>{e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},10846:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},19771:e=>{e.exports=require("process")},27910:e=>{e.exports=require("stream")},28354:e=>{e.exports=require("util")},29080:(e,t,r)=>{r.r(t),r.d(t,{patchFetch:()=>x,routeModule:()=>d,serverHooks:()=>c,workAsyncStorage:()=>m,workUnitAsyncStorage:()=>g});var s={};r.r(s),r.d(s,{POST:()=>l});var n=r(96559),i=r(48088),o=r(37719),a=r(32190),u=r(75365),p=r(42192);async function l(e){try{let{botType:t,message:r}=await e.json();if(!t||!r||"client"!==t&&"admin"!==t)return a.NextResponse.json({message:"Некорректный тип бота или отсутствует сообщение."},{status:400});let s=await (0,u.P)("SELECT * FROM site_telegram_settings WHERE id = ? LIMIT 1",[1]);if(!Array.isArray(s)||0===s.length)return a.NextResponse.json({message:"Настройки Telegram не найдены."},{status:404});let n=s[0],i="client"===t?n.client_bot_token:n.admin_bot_token,o="client"===t?n.client_bot_chat_id:n.admin_bot_chat_ids;if(!i)return a.NextResponse.json({message:`Токен для ${"client"===t?"клиентского":"админского"} бота не настроен.`},{status:400});if(!o)return a.NextResponse.json({message:`ID чата(ов) для ${"client"===t?"клиентского":"админского"} бота не настроен.`},{status:400});let l=o.split(",").map(e=>e.trim()).filter(e=>e);if(0===l.length)return a.NextResponse.json({message:`Не указаны корректные ID чата(ов) для ${"client"===t?"клиентского":"админского"} бота.`},{status:400});let d=!0,m=null;for(let e of l){let s=await (0,p.V5)(i,e,r);s.success||(d=!1,m||(m=s.error||"Unknown error during sending."),console.error(`Failed to send test message to ${e} for ${t} bot:`,s.error))}if(d)return a.NextResponse.json({message:`Тестовое сообщение успешно отправлено на ${l.join(", ")} через ${"client"===t?"клиентского":"админского"} бота.`});return a.NextResponse.json({message:`Не удалось отправить тестовое сообщение на один или несколько чатов. Первая ошибка: ${m}`},{status:500})}catch(e){return console.error("API Send Test Telegram Error:",e),a.NextResponse.json({message:`Внутренняя ошибка сервера: ${e.message}`},{status:500})}}let d=new n.AppRouteRouteModule({definition:{kind:i.RouteKind.APP_ROUTE,page:"/api/admin/site-settings/telegram/test-message/route",pathname:"/api/admin/site-settings/telegram/test-message",filename:"route",bundlePath:"app/api/admin/site-settings/telegram/test-message/route"},resolvedPagePath:"/var/www/html/src/app/api/admin/site-settings/telegram/test-message/route.ts",nextConfigOutput:"",userland:s}),{workAsyncStorage:m,workUnitAsyncStorage:g,serverHooks:c}=d;function x(){return(0,o.patchFetch)({workAsyncStorage:m,workUnitAsyncStorage:g})}},29294:e=>{e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},34631:e=>{e.exports=require("tls")},41204:e=>{e.exports=require("string_decoder")},44870:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},55511:e=>{e.exports=require("crypto")},63033:e=>{e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},66136:e=>{e.exports=require("timers")},74075:e=>{e.exports=require("zlib")},79428:e=>{e.exports=require("buffer")},79551:e=>{e.exports=require("url")},91645:e=>{e.exports=require("net")},94735:e=>{e.exports=require("events")}};var t=require("../../../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[4447,6724,5482,580,4800],()=>r(29080));module.exports=s})();