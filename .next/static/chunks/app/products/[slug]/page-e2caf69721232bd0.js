(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2221],{6160:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});let a=(0,s(40157).A)("CreditCard",[["rect",{width:"20",height:"14",x:"2",y:"5",rx:"2",key:"ynyp8z"}],["line",{x1:"2",x2:"22",y1:"10",y2:"10",key:"1b3vmo"}]])},12543:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});let a=(0,s(40157).A)("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]])},17607:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});let a=(0,s(40157).A)("Eye",[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]])},18763:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});let a=(0,s(40157).A)("SquarePen",[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]])},25318:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});let a=(0,s(40157).A)("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]])},30462:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});let a=(0,s(40157).A)("Star",[["path",{d:"M11.525 2.295a.53.53 0 0 1 .95 0l2.31 4.679a2.123 2.123 0 0 0 1.595 1.16l5.166.756a.53.53 0 0 1 .294.904l-3.736 3.638a2.123 2.123 0 0 0-.611 1.878l.882 5.14a.53.53 0 0 1-.771.56l-4.618-2.428a2.122 2.122 0 0 0-1.973 0L6.396 21.01a.53.53 0 0 1-.77-.56l.881-5.139a2.122 2.122 0 0 0-.611-1.879L2.16 9.795a.53.53 0 0 1 .294-.906l5.165-.755a2.122 2.122 0 0 0 1.597-1.16z",key:"r04s7s"}]])},40283:(e,t,s)=>{"use strict";s.d(t,{A:()=>d,AuthProviderClient:()=>n,O:()=>c});var a=s(95155),r=s(12115),l=s(35695);let i=(0,r.createContext)(void 0),n=e=>{let{children:t}=e;return(0,a.jsx)(a.Fragment,{children:t})},c=e=>{let{children:t}=e,[s,n]=(0,r.useState)(null),[c,d]=(0,r.useState)(!0),o=(0,l.useRouter)(),m=(0,l.usePathname)(),u=e=>{if(e&&e.id&&e.username&&e.email){let t=0;return"string"==typeof e.balance?t=parseFloat(e.balance):"number"==typeof e.balance&&(t=e.balance),isNaN(t)&&(t=0),{...e,balance:t}}return null},x=(0,r.useCallback)(async e=>{try{let t=await fetch("/api/user/".concat(e,"/details"));if(!t.ok){let s=await t.json().catch(()=>({message:"Failed to fetch updated user details"}));return console.warn("Failed to fetch updated user details for user ".concat(e,": ").concat(s.message||t.statusText)),null}let s=await t.json(),a=u(s.user);if(a)return n(a),localStorage.setItem("currentUser",JSON.stringify(a)),a;return null}catch(e){return console.error("Error fetching user details:",e),null}},[]);(0,r.useEffect)(()=>{(async()=>{d(!0);let e=localStorage.getItem("currentUser");if(e)try{let t=JSON.parse(e),s=u(t);if(s&&s.id){let e=await x(s.id);e?n(e):(n(s),console.warn("Used stored user details as fresh fetch failed."))}else localStorage.removeItem("currentUser"),n(null)}catch(e){console.error("Failed to parse or refresh stored user:",e),localStorage.removeItem("currentUser"),n(null)}d(!1)})()},[x]);let h=(0,r.useCallback)(async(e,t)=>{d(!0);try{let s=await fetch("/api/auth/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({emailOrLogin:e,password:t})}),a=await s.json();if(!s.ok)throw Error(a.message||"Login failed");if(a.user&&a.user.id){if(await x(a.user.id))o.push("/account");else{let e=u(a.user);if(e)n(e),localStorage.setItem("currentUser",JSON.stringify(e)),o.push("/account");else throw Error("Invalid user data received from login.")}}else throw Error("Login response did not include user ID.")}catch(e){throw console.error("Login error in AuthContext:",e),n(null),localStorage.removeItem("currentUser"),e}finally{d(!1)}},[o,x]),p=(0,r.useCallback)(async(e,t,s,a)=>{d(!0);try{let r=await fetch("/api/auth/register",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:e,email:t,password:s,referralCode:a})}),l=await r.json();if(!r.ok)throw Error(l.message||"Registration failed");o.push("/auth/login?registrationSuccess=true")}catch(e){throw console.error("Registration error in AuthContext:",e),e}finally{d(!1)}},[o]),f=(0,r.useCallback)(()=>{n(null),localStorage.removeItem("currentUser"),m.startsWith("/account")||m.startsWith("/admin")?o.push("/auth/login"):o.push("/")},[o,m]);return(0,a.jsx)(i.Provider,{value:{currentUser:s,loading:c,login:h,register:p,logout:f,fetchUserDetails:x,setCurrentUser:n},children:t})},d=()=>{let e=(0,r.useContext)(i);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},50594:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});let a=(0,s(40157).A)("Info",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]])},53054:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});let a=(0,s(40157).A)("Tag",[["path",{d:"M12.586 2.586A2 2 0 0 0 11.172 2H4a2 2 0 0 0-2 2v7.172a2 2 0 0 0 .586 1.414l8.704 8.704a2.426 2.426 0 0 0 3.42 0l6.58-6.58a2.426 2.426 0 0 0 0-3.42z",key:"vktsd0"}],["circle",{cx:"7.5",cy:"7.5",r:".5",fill:"currentColor",key:"kqv944"}]])},54165:(e,t,s)=>{"use strict";s.d(t,{Cf:()=>u,Es:()=>h,L3:()=>p,c7:()=>x,lG:()=>c,rr:()=>f,zM:()=>d});var a=s(95155),r=s(12115),l=s(15452),i=s(25318),n=s(59434);let c=l.bL,d=l.l9,o=l.ZL;l.bm;let m=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)(l.hJ,{ref:t,className:(0,n.cn)("fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",s),...r})});m.displayName=l.hJ.displayName;let u=r.forwardRef((e,t)=>{let{className:s,children:r,...c}=e;return(0,a.jsxs)(o,{children:[(0,a.jsx)(m,{}),(0,a.jsxs)(l.UC,{ref:t,className:(0,n.cn)("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",s),...c,children:[r,(0,a.jsxs)(l.bm,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[(0,a.jsx)(i.A,{className:"h-4 w-4"}),(0,a.jsx)("span",{className:"sr-only",children:"Close"})]})]})]})});u.displayName=l.UC.displayName;let x=e=>{let{className:t,...s}=e;return(0,a.jsx)("div",{className:(0,n.cn)("flex flex-col space-y-1.5 text-center sm:text-left",t),...s})};x.displayName="DialogHeader";let h=e=>{let{className:t,...s}=e;return(0,a.jsx)("div",{className:(0,n.cn)("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",t),...s})};h.displayName="DialogFooter";let p=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)(l.hE,{ref:t,className:(0,n.cn)("text-lg font-semibold leading-none tracking-tight",s),...r})});p.displayName=l.hE.displayName;let f=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)(l.VY,{ref:t,className:(0,n.cn)("text-sm text-muted-foreground",s),...r})});f.displayName=l.VY.displayName},66435:(e,t,s)=>{"use strict";s.d(t,{default:()=>X});var a=s(95155),r=s(12115),l=s(40283),i=s(6874),n=s.n(i),c=s(66695),d=s(26126),o=s(30285),m=s(8376),u=s(67554),x=s(31949),h=s(12543),p=s(18763),f=s(40157);let g=(0,f.A)("VenetianMask",[["path",{d:"M18 11c-1.5 0-2.5.5-3 2",key:"1fod00"}],["path",{d:"M4 6a2 2 0 0 0-2 2v4a5 5 0 0 0 5 5 8 8 0 0 1 5 2 8 8 0 0 1 5-2 5 5 0 0 0 5-5V8a2 2 0 0 0-2-2h-3a8 8 0 0 0-5 2 8 8 0 0 0-5-2z",key:"d70hit"}],["path",{d:"M6 11c1.5 0 2.5.5 3 2",key:"136fht"}]]);var y=s(17607);let j=(0,f.A)("Sparkles",[["path",{d:"M9.937 15.5A2 2 0 0 0 8.5 14.063l-6.135-1.582a.5.5 0 0 1 0-.962L8.5 9.936A2 2 0 0 0 9.937 8.5l1.582-6.135a.5.5 0 0 1 .963 0L14.063 8.5A2 2 0 0 0 15.5 9.937l6.135 1.581a.5.5 0 0 1 0 .964L15.5 14.063a2 2 0 0 0-1.437 1.437l-1.582 6.135a.5.5 0 0 1-.963 0z",key:"4pj2yx"}],["path",{d:"M20 3v4",key:"1olli1"}],["path",{d:"M22 5h-4",key:"1gvqau"}],["path",{d:"M4 17v2",key:"vumght"}],["path",{d:"M5 18H3",key:"zchphs"}]]);var b=s(94394),N=s(50594),v=s(59434),w=s(87481),k=s(53054),_=s(98328),A=s(6160),S=s(94815);let C=e=>{let{productName:t,productId:s,allPricingOptions:i=[]}=e,{toast:d}=(0,w.dj)(),{currentUser:m,fetchUserDetails:u}=(0,l.A)(),[x,h]=(0,r.useState)([]),[p,f]=(0,r.useState)(null),g=(0,r.useMemo)(()=>p&&i?i.filter(e=>{var t;let s=null===(t=e.mode_label)||void 0===t?void 0:t.trim();return"По умолчанию"===p?!s:s===p}):[],[p,i]),[y,j]=(0,r.useState)(null);(0,r.useEffect)(()=>{if(i&&i.length>0){let e=new Set,t=!1;i.forEach(s=>{s.mode_label&&""!==s.mode_label.trim()?e.add(s.mode_label.trim()):t=!0});let s=Array.from(e);t&&0===s.length?(h(["По умолчанию"]),f("По умолчанию")):t&&s.length>0?(h([...s,"По умолчанию"]),f(s[0])):s.length>0?(h(s),f(s[0])):(h([]),f(null))}else h([]),f(null)},[i]),(0,r.useEffect)(()=>{g.length>0?j(g[0]):j(null)},[g]);let b=e=>{f(e)},N=e=>{j(e)},C=(e,t)=>{let s=Number.isInteger(e)?e.toLocaleString("ru-RU",{minimumFractionDigits:0,maximumFractionDigits:0}):e.toLocaleString("ru-RU",{minimumFractionDigits:2,maximumFractionDigits:2});return"".concat(s," ").concat("RUB"===t?"₽":t)},M=async()=>{if(!m){d({title:"Ошибка",description:"Пожалуйста, войдите в аккаунт для покупки за GH.",variant:"destructive"});return}if(!y){d({title:"Ошибка",description:"Пожалуйста, выберите вариант.",variant:"destructive"});return}if(m.balance<y.price_gh){d({title:"Недостаточно средств",description:"На вашем балансе ".concat(m.balance.toFixed(2)," GH. Требуется ").concat(y.price_gh.toFixed(2)," GH."),variant:"destructive"});return}try{let e=await fetch("/api/purchase/product",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:m.id,productId:s,productPricingOptionId:y.id})}),r=await e.json();if(!e.ok)throw Error(r.message||"Не удалось совершить покупку.");m.id&&await u(m.id),d({title:"Покупка успешна!",description:"".concat(t," (").concat(y.duration_days," дн.").concat(y.mode_label&&"По умолчанию"!==y.mode_label?", ".concat(y.mode_label):"",") добавлен в ваш инвентарь."),action:(0,a.jsx)(o.$,{variant:"link",size:"sm",asChild:!0,className:"text-primary",children:(0,a.jsx)(n(),{href:"/account/inventory",children:"Инвентарь"})})})}catch(e){d({title:"Ошибка покупки",description:e.message,variant:"destructive"})}};return 0===i.length?(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:"Варианты цен для этого товара еще не добавлены."}):(0,a.jsxs)("div",{className:"space-y-4",children:[x.length>1&&(0,a.jsxs)("div",{children:[(0,a.jsxs)("p",{className:"text-sm font-medium text-foreground mb-2 flex items-center",children:[(0,a.jsx)(k.A,{className:"mr-2 h-4 w-4 text-primary/80"}),"Выберите режим:"]}),(0,a.jsx)("div",{className:"flex flex-wrap gap-2",children:x.map(e=>(0,a.jsx)(o.$,{variant:p===e?"default":"outline",onClick:()=>b(e),className:(0,v.cn)("text-sm px-4 py-2 h-auto",p===e?"bg-primary text-primary-foreground":"border-primary text-primary hover:bg-primary/10"),size:"default",children:e},e))})]}),1===x.length&&p&&"По умолчанию"!==p&&(0,a.jsx)("div",{children:(0,a.jsxs)("p",{className:"text-sm font-medium text-foreground mb-0 flex items-center",children:[(0,a.jsx)(k.A,{className:"mr-2 h-4 w-4 text-primary/80"}),"Режим: ",(0,a.jsx)("span",{className:"ml-1 font-normal text-muted-foreground",children:p})]})}),g.length>0&&(0,a.jsxs)("div",{className:"mt-3",children:[(0,a.jsxs)("p",{className:"text-sm font-medium text-foreground mb-2 flex items-center",children:[(0,a.jsx)(_.A,{className:"mr-2 h-4 w-4 text-primary/80"}),"Выберите срок:"]}),(0,a.jsx)("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-2",children:g.map(e=>(0,a.jsxs)(o.$,{variant:(null==y?void 0:y.id)===e.id?"default":"outline",onClick:()=>N(e),className:(0,v.cn)("w-full justify-center text-center h-auto py-2 px-3 text-sm",(null==y?void 0:y.id)===e.id?"bg-primary text-primary-foreground border-primary":"border-primary text-primary hover:bg-primary/10"),children:[e.duration_days," дн."]},e.id))})]}),0===g.length&&p&&(0,a.jsxs)("p",{className:"text-sm text-muted-foreground mt-2",children:['Варианты для режима "',p,'" отсутствуют.']}),y&&(0,a.jsxs)(c.Zp,{className:"mt-4 bg-muted/20 border-border/30 shadow-inner",children:[(0,a.jsxs)(c.aR,{className:"p-3",children:[(0,a.jsx)(c.ZB,{className:"text-sm text-muted-foreground text-center",children:y.mode_label&&"По умолчанию"!==y.mode_label?"Режим: ".concat(y.mode_label):"Стандартный режим"}),(0,a.jsxs)(c.BT,{className:"text-xs text-muted-foreground text-center",children:["Выбран срок: ",y.duration_days," дн."]})]}),(0,a.jsxs)(c.Wu,{className:"p-3 pt-0 space-y-1",children:[(y.price_rub>0||y.price_gh>0)&&(0,a.jsxs)("div",{className:"flex justify-between items-baseline text-primary font-bold",children:[(0,a.jsxs)("span",{className:"text-sm text-muted-foreground flex items-center",children:[(0,a.jsx)(A.A,{className:"mr-1.5 h-4 w-4"}),"Стоимость:"]}),(0,a.jsxs)("div",{className:"text-right",children:[y.price_rub>0&&(0,a.jsx)("p",{className:"text-lg",children:C(y.price_rub,"RUB")}),y.price_gh>0&&(0,a.jsx)("p",{className:(0,v.cn)("text-lg",y.price_rub>0&&"text-base"),children:C(y.price_gh,"GH")})]})]}),0===y.price_rub&&0===y.price_gh&&(0,a.jsx)("p",{className:"text-sm text-muted-foreground text-center",children:"Цена не указана."})]}),(0,a.jsxs)(c.wL,{className:"p-3 pt-2 flex flex-col gap-2",children:[y.price_rub>0&&(0,a.jsxs)(o.$,{onClick:()=>{(null==y?void 0:y.payment_link)&&""!==y.payment_link.trim()&&"#"!==y.payment_link.trim()?window.open(y.payment_link.trim(),"_blank"):d({title:"Оплата RUB недоступна",description:"Ссылка на оплату для этого варианта не настроена. Пожалуйста, попробуйте позже.",variant:"default"})},size:"lg",className:"w-full bg-primary hover:bg-primary/90 text-primary-foreground shadow-md",disabled:!y.payment_link||""===y.payment_link.trim()||"#"===y.payment_link.trim(),title:y.payment_link&&""!==y.payment_link.trim()&&"#"!==y.payment_link.trim()?"Оплатить рублями":"Ссылка на оплату не настроена",children:[(0,a.jsx)(S.A,{className:"mr-2 h-5 w-5"}),"Купить за ",C(y.price_rub,"RUB")]}),y.price_gh>0&&(0,a.jsxs)(o.$,{onClick:M,size:"lg",variant:"outline",className:"w-full border-primary text-primary hover:bg-primary/10 hover:text-primary/90 shadow-md",children:[(0,a.jsx)(S.A,{className:"mr-2 h-5 w-5"}),"Купить за ",C(y.price_gh,"GH")]})]}),y.price_rub>0&&(!y.payment_link||""===y.payment_link.trim()||"#"===y.payment_link.trim())&&(0,a.jsx)("p",{className:"text-xs text-center text-muted-foreground pt-1 px-3 pb-2",children:"Оплата в RUB временно недоступна."})]})]})};var M=s(66766),T=s(54165);let E=e=>{let{src:t,alt:s}=e,[l,i]=(0,r.useState)(!1);return(0,a.jsxs)(T.lG,{open:l,onOpenChange:i,children:[(0,a.jsx)(T.zM,{asChild:!0,children:(0,a.jsx)("div",{className:"relative aspect-video rounded-lg overflow-hidden border border-border cursor-pointer hover:opacity-80 transition-opacity",children:(0,a.jsx)(M.default,{src:t,alt:s,layout:"fill",objectFit:"cover","data-ai-hint":"software menu screenshot"})})}),(0,a.jsxs)(T.Cf,{className:"max-w-3xl max-h-[80vh] p-2 bg-background border-border shadow-xl",children:[(0,a.jsx)(T.L3,{className:"sr-only",children:"Enlarged image: ".concat(s)}),(0,a.jsx)("div",{className:"relative w-full h-[75vh]",children:(0,a.jsx)(M.default,{src:t,alt:"".concat(s," - enlarged"),layout:"fill",objectFit:"contain"})})]})]})};var R=s(24295),I=s(62177),O=s(90221),z=s(55594),L=s(88539),U=s(85057),D=s(94063),Z=s(50172),F=s(11133),H=s(30462),B=s(73672);let P=z.Ik({rating:z.au.number().min(1,"Пожалуйста, выберите рейтинг.").max(5),text:z.Yj().min(10,"Отзыв должен содержать не менее 10 символов.").max(2e3,"Отзыв не должен превышать 2000 символов.")}),W=e=>{let{productId:t,productName:s,onReviewSubmitted:i}=e,{toast:d}=(0,w.dj)(),{currentUser:m}=(0,l.A)(),[u,x]=(0,r.useState)(!1),[h,p]=(0,r.useState)(0),[f,g]=(0,r.useState)(!1),[y,j]=(0,r.useState)(!0),b=(0,I.mN)({resolver:(0,O.u)(P),defaultValues:{rating:0,text:""}}),N=b.watch("rating"),k=(0,r.useCallback)(async()=>{if(!m||!t){j(!1),g(!1);return}j(!0);try{let e=await fetch("/api/user/".concat(m.id,"/has-purchased/").concat(t));if(e.ok){let t=await e.json();g(t.hasPurchased)}else g(!1)}catch(e){console.error("Error checking purchase status:",e),g(!1)}finally{j(!1)}},[m,t]);(0,r.useEffect)(()=>{k()},[k]);let _=async e=>{if(!m){d({title:"Ошибка",description:"Для оставления отзыва необходимо авторизоваться.",variant:"destructive"});return}if(!f){d({title:"Действие не разрешено",description:'Чтобы оставить отзыв, вам необходимо приобрести подписку на "'.concat(s,'".'),variant:"destructive"});return}x(!0);try{let s=await fetch("/api/products/".concat(t,"/reviews"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:m.id,rating:e.rating,text:e.text})}),a=await s.json();if(!s.ok)throw Error(a.message||"Не удалось отправить отзыв.");d({title:"Отзыв отправлен!",description:"Спасибо! Ваш отзыв отправлен на модерацию."}),b.reset(),i&&i()}catch(e){d({title:"Ошибка",description:e.message||"Произошла ошибка при отправке отзыва.",variant:"destructive"})}finally{x(!1)}};return m?y?(0,a.jsxs)(c.Zp,{className:"mt-8 shadow-md border-border/30 bg-card",children:[(0,a.jsx)(c.aR,{children:(0,a.jsxs)(c.ZB,{className:"text-lg text-primary flex items-center",children:[(0,a.jsx)(D.A,{className:"mr-2 h-5 w-5"})," Оставить отзыв"]})}),(0,a.jsxs)(c.Wu,{className:"py-10 flex items-center justify-center",children:[(0,a.jsx)(Z.A,{className:"h-6 w-6 animate-spin text-primary mr-2"}),(0,a.jsx)("p",{className:"text-muted-foreground",children:"Проверка ваших покупок..."})]})]}):f?(0,a.jsxs)(c.Zp,{className:"mt-8 shadow-md border-border/30 bg-card",children:[(0,a.jsx)(c.aR,{children:(0,a.jsxs)(c.ZB,{className:"text-lg text-primary flex items-center",children:[(0,a.jsx)(D.A,{className:"mr-2 h-5 w-5"}),' Оставить отзыв о "',s,'"']})}),(0,a.jsx)(c.Wu,{children:(0,a.jsxs)("form",{onSubmit:b.handleSubmit(_),className:"space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)(U.Label,{className:"text-foreground mb-2 block",children:"Ваша оценка:"}),(0,a.jsx)("div",{className:"flex items-center space-x-1",onMouseLeave:()=>p(0),children:[1,2,3,4,5].map(e=>(0,a.jsx)(H.A,{className:(0,v.cn)("h-7 w-7 cursor-pointer transition-colors",h>=e||N>=e?"text-yellow-400 fill-yellow-400":"text-muted-foreground hover:text-yellow-300"),onClick:()=>b.setValue("rating",e,{shouldValidate:!0}),onMouseEnter:()=>p(e)},e))}),b.formState.errors.rating&&(0,a.jsx)("p",{className:"text-sm text-destructive mt-1",children:b.formState.errors.rating.message})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(U.Label,{htmlFor:"reviewText",className:"text-foreground",children:"Ваш отзыв:"}),(0,a.jsx)(L.T,{id:"reviewText",...b.register("text"),placeholder:"Поделитесь своим мнением о ".concat(s,"..."),className:"mt-1 min-h-[100px] bg-background",disabled:u}),b.formState.errors.text&&(0,a.jsx)("p",{className:"text-sm text-destructive mt-1",children:b.formState.errors.text.message})]}),(0,a.jsxs)(o.$,{type:"submit",className:"bg-primary hover:bg-primary/90 text-primary-foreground",disabled:u,children:[u?(0,a.jsx)(Z.A,{className:"mr-2 h-4 w-4 animate-spin"}):(0,a.jsx)(B.A,{className:"mr-2 h-4 w-4"}),"Отправить отзыв"]})]})})]}):(0,a.jsxs)(c.Zp,{className:"mt-8 shadow-md border-border/30 bg-card",children:[(0,a.jsx)(c.aR,{children:(0,a.jsxs)(c.ZB,{className:"text-lg text-primary flex items-center",children:[(0,a.jsx)(F.A,{className:"mr-2 h-5 w-5"})," Оставить отзыв"]})}),(0,a.jsxs)(c.Wu,{children:[(0,a.jsxs)("p",{className:"text-muted-foreground",children:['Чтобы оставить отзыв, вам необходимо приобрести подписку на "',s,'".']}),(0,a.jsx)(o.$,{asChild:!0,className:"mt-3 bg-primary hover:bg-primary/90 text-primary-foreground",children:(0,a.jsxs)(n(),{href:"/products/".concat(t),children:[(0,a.jsx)(S.A,{className:"mr-2 h-4 w-4"})," К покупке"]})})]})]}):(0,a.jsxs)(c.Zp,{className:"mt-8 shadow-md border-border/30 bg-card",children:[(0,a.jsx)(c.aR,{children:(0,a.jsxs)(c.ZB,{className:"text-lg text-primary flex items-center",children:[(0,a.jsx)(D.A,{className:"mr-2 h-5 w-5"})," Оставить отзыв"]})}),(0,a.jsx)(c.Wu,{children:(0,a.jsxs)("p",{className:"text-muted-foreground",children:["Пожалуйста, ",(0,a.jsx)(n(),{href:"/auth/login",className:"text-primary hover:underline",children:"войдите"})," или ",(0,a.jsx)(n(),{href:"/auth/register",className:"text-primary hover:underline",children:"зарегистрируйтесь"}),", чтобы оставить отзыв."]})})]})},V=(0,f.A)("MessageSquareText",[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",key:"1lielz"}],["path",{d:"M13 8H7",key:"14i4kc"}],["path",{d:"M17 12H7",key:"16if0g"}]]);var $=s(73158);let G=e=>{let{review:t}=e;return(0,a.jsxs)("div",{className:"p-4 border border-border/30 rounded-lg bg-muted/20 shadow-sm",children:[(0,a.jsxs)("div",{className:"flex items-start gap-3",children:[(0,a.jsx)(M.default,{src:t.user_avatar_url||"https://placehold.co/40x40.png?text=".concat(t.username?t.username[0].toUpperCase():"U"),alt:t.username,width:36,height:36,className:"rounded-full","data-ai-hint":"user avatar"}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("p",{className:"font-semibold text-sm text-foreground",children:t.username}),(0,a.jsx)(e=>{let{rating:t}=e;return(0,a.jsx)("div",{className:"flex",children:[1,2,3,4,5].map(e=>(0,a.jsx)(H.A,{className:(0,v.cn)("h-4 w-4",t>=e?"text-yellow-400 fill-yellow-400":"text-muted-foreground/50")},e))})},{rating:t.rating})]}),(0,a.jsx)("p",{className:"text-xs text-muted-foreground",children:(e=>e?new Date(e).toLocaleDateString("ru-RU",{year:"numeric",month:"long",day:"numeric"}):"N/A")(t.approved_at||t.created_at)})]})]}),(0,a.jsx)("p",{className:"text-sm text-foreground/80 mt-2 whitespace-pre-wrap",children:t.text}),t.duration_days&&(0,a.jsxs)("p",{className:"text-xs text-muted-foreground mt-1",children:["(Относится к варианту: ",t.duration_days," дн.)"]})]})},J=e=>{let{productId:t,productName:s,refreshTrigger:l}=e,[i,d]=(0,r.useState)([]),[o,m]=(0,r.useState)(!0),[u,h]=(0,r.useState)(null),{toast:p}=(0,w.dj)(),f=(0,r.useCallback)(async()=>{if(t){m(!0),h(null);try{let e=await fetch("/api/products/".concat(t,"/reviews"));if(!e.ok){let t=await e.json().catch(()=>({message:"Failed to fetch reviews for this product"}));throw Error(t.message)}let s=await e.json();d(s)}catch(e){h(e.message||"Не удалось загрузить отзывы для ".concat(s,"."))}finally{m(!1)}}},[t,s,p]);return(0,r.useEffect)(()=>{f()},[f,l]),(0,a.jsxs)(c.Zp,{className:"mt-8 shadow-md border-border/30 bg-card",children:[(0,a.jsxs)(c.aR,{children:[(0,a.jsxs)(c.ZB,{className:"text-lg text-primary flex items-center",children:[(0,a.jsx)(V,{className:"mr-2 h-5 w-5"}),' Отзывы о "',s,'"']}),i.length>0&&(0,a.jsx)(c.BT,{className:"text-muted-foreground",children:"Что говорят другие игроки."})]}),(0,a.jsx)(c.Wu,{children:o?(0,a.jsxs)("div",{className:"flex justify-center items-center py-6",children:[(0,a.jsx)(Z.A,{className:"h-6 w-6 animate-spin text-primary"}),(0,a.jsx)("p",{className:"ml-2 text-muted-foreground",children:"Загрузка отзывов..."})]}):u?(0,a.jsxs)("div",{className:"text-center py-6 text-destructive",children:[(0,a.jsx)(x.A,{className:"mx-auto h-8 w-8 mb-2"}),(0,a.jsx)("p",{children:u})]}):i.length>0?(0,a.jsxs)("div",{className:"space-y-4",children:[i.map(e=>(0,a.jsx)(G,{review:e},e.id)),i.length>=3&&(0,a.jsx)("div",{className:"text-center mt-4",children:(0,a.jsx)(Button,{variant:"link",asChild:!0,className:"text-primary hover:text-primary/80",children:(0,a.jsxs)(n(),{href:"/reviews",children:["Все отзывы ",(0,a.jsx)($.A,{className:"h-4 w-4 ml-1"})]})})})]}):(0,a.jsx)("p",{className:"text-muted-foreground text-center py-6",children:"Отзывов для этого товара пока нет. Будьте первым!"})})]})},q={safe:{text:"Безопасен",icon:m.A,colorClass:"text-primary",badgeClass:"bg-primary/20 text-primary border-primary/40"},updating:{text:"На обновлении",icon:u.A,colorClass:"text-sky-400",badgeClass:"bg-sky-500/20 text-sky-400 border-sky-500/40 animate-pulse"},risky:{text:"Не безопасен",icon:x.A,colorClass:"text-red-400",badgeClass:"bg-red-600/20 text-red-400 border-red-600/40"},unknown:{text:"На обновлении",icon:u.A,colorClass:"text-sky-400",badgeClass:"bg-sky-500/20 text-sky-400 border-sky-500/40 animate-pulse"}},Y=e=>{if(!e||"string"!=typeof e||""===e.trim())return!1;try{return new URL(e.trim()),/\.(jpeg|jpg|gif|png|webp)$/i.test(new URL(e.trim()).pathname)}catch(e){return!1}},X=e=>{var t;let{product:s,category:i,relatedProducts:m}=e,{currentUser:u}=(0,l.A)(),[x,f]=(0,r.useState)(0),w=q[s.status]||q.unknown,k=w.icon,_=(null===(t=s.gallery_image_urls)||void 0===t?void 0:t.map(e=>e.trim()).filter(Y))||[],A=e=>{let{title:t,description:s,functions:r,icon:l}=e;return t&&r&&0!==r.length?(0,a.jsxs)("div",{className:"p-4 border border-border/30 rounded-md bg-card/50 shadow-sm",children:[(0,a.jsxs)("h4",{className:"text-md font-semibold text-primary mb-1.5 flex items-center",children:[l&&(0,a.jsx)(l,{className:"mr-2 h-5 w-5 text-primary/80"}),t]}),s&&(0,a.jsx)("p",{className:"text-xs text-muted-foreground mb-2",children:s}),(0,a.jsx)("div",{className:"flex flex-wrap gap-2",children:r.map((e,s)=>(0,a.jsx)(d.E,{variant:"outline",className:"border-primary/50 text-foreground/90 text-xs",children:e},"".concat(t,"-").concat(s)))})]}):null};return(0,a.jsxs)("div",{className:"container mx-auto px-4 py-8",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 mb-6",children:[(0,a.jsx)(o.$,{asChild:!0,variant:"outline",className:"border-primary text-primary hover:bg-primary/10",children:(0,a.jsxs)(n(),{href:i?"/games/".concat(i.slug):"/games",children:[(0,a.jsx)(h.A,{className:"mr-2 h-4 w-4"}),"Назад к ",i?i.name:"Каталогу"]})}),(null==u?void 0:u.role)==="admin"&&(0,a.jsx)(o.$,{asChild:!0,variant:"outline",className:"border-icon-color text-icon-color hover:bg-icon-color/10 hover:text-icon-color/90",children:(0,a.jsxs)(n(),{href:"/admin/products/".concat(s.slug,"/edit"),children:[(0,a.jsx)(p.A,{className:"mr-2 h-4 w-4"}),"Редактировать товар"]})})]}),(0,a.jsxs)("div",{className:"grid lg:grid-cols-3 gap-8",children:[(0,a.jsxs)("div",{className:"lg:col-span-2 space-y-8",children:[(0,a.jsxs)(c.Zp,{className:"shadow-xl overflow-hidden",children:[(0,a.jsx)(c.aR,{className:"p-6 border-b border-border",children:(0,a.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-start sm:justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-2xl md:text-3xl font-semibold text-foreground mb-1",children:s.name}),i&&(0,a.jsxs)(n(),{href:"/games/".concat(i.slug),className:"text-sm text-muted-foreground hover:text-primary transition-colors block mb-2 sm:mb-0",children:["Категория: ",i.name]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2 mt-2 sm:mt-0",children:[k&&(0,a.jsx)(k,{className:(0,v.cn)("h-4 w-4 sm:h-5 sm:w-5",w.iconColor,"updating"===s.status||"unknown"===s.status?"animate-pulse":"")}),(0,a.jsx)("span",{className:(0,v.cn)("text-xs sm:text-sm font-medium",w.colorClass),children:s.status_text||w.text})]})]})}),_&&_.length>0&&(0,a.jsxs)(c.Wu,{className:"p-6",children:[(0,a.jsx)("h3",{className:"text-xl font-bold text-foreground mb-3 uppercase",children:"Галерея (Меню софта)"}),(0,a.jsx)("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4",children:_.map((e,t)=>(0,a.jsx)(E,{src:e,alt:"".concat(s.name," - Gallery image ").concat(t+1)},t))})]}),(0,a.jsxs)(c.Wu,{className:"p-6 border-t border-border",children:[(0,a.jsx)("h3",{className:"text-xl font-bold text-foreground mb-3 uppercase",children:"Описание"}),s.long_description?(0,a.jsx)("div",{className:"prose prose-sm dark:prose-invert max-w-none text-foreground/80",dangerouslySetInnerHTML:{__html:s.long_description}}):s.short_description?(0,a.jsx)("p",{className:"text-foreground/80",children:s.short_description}):(0,a.jsx)("p",{className:"text-muted-foreground",children:"Описание для этого товара еще не добавлено."})]}),s.functions_aim_title&&s.functions_aim&&s.functions_aim.length>0||s.functions_esp_title&&s.functions_wallhack&&s.functions_wallhack.length>0||s.functions_misc_title&&s.functions_misc&&s.functions_misc.length>0?(0,a.jsxs)(c.Wu,{className:"p-6 border-t border-border",children:[(0,a.jsx)("h3",{className:"text-xl font-bold text-foreground mb-4 uppercase",children:"Функционал"}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)(A,{title:s.functions_aim_title,description:s.functions_aim_description,functions:s.functions_aim,icon:g}),(0,a.jsx)(A,{title:s.functions_esp_title,description:s.functions_esp_description,functions:s.functions_wallhack,icon:y.A}),(0,a.jsx)(A,{title:s.functions_misc_title,description:s.functions_misc_description,functions:s.functions_misc,icon:j})]})]}):null]}),(0,a.jsx)(J,{productId:s.slug,productName:s.name,refreshTrigger:x}),(0,a.jsx)(W,{productId:s.slug,productName:s.name,onReviewSubmitted:()=>{f(e=>e+1)}}),(0,a.jsxs)("div",{className:"mt-8",children:[(0,a.jsx)("h3",{className:"text-xl text-foreground font-bold uppercase mb-4",children:"Похожие товары"}),m.length>0?(0,a.jsx)("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-6",children:m.map(e=>(0,a.jsx)(R.A,{product:e},e.id))}):(0,a.jsx)("p",{className:"text-muted-foreground",children:"Других товаров в этой категории пока нет."})]})]}),(0,a.jsx)("div",{className:"lg:col-span-1",children:(0,a.jsxs)("div",{className:"lg:sticky lg:top-24 space-y-8",children:[(0,a.jsxs)(c.Zp,{className:"shadow-lg",children:[(0,a.jsx)(c.aR,{children:(0,a.jsxs)(c.ZB,{className:"text-xl text-primary flex items-center font-bold uppercase",children:[(0,a.jsx)(b.A,{className:"mr-2 h-6 w-6"}),"Стоимость"]})}),(0,a.jsx)(c.Wu,{children:(0,a.jsx)(C,{productName:s.name,productId:s.id,allPricingOptions:s.pricing_options||[]})})]}),(0,a.jsxs)(c.Zp,{className:"shadow-lg",children:[(0,a.jsx)(c.aR,{children:(0,a.jsxs)(c.ZB,{className:"text-xl text-primary flex items-center font-bold uppercase",children:[(0,a.jsx)(N.A,{className:"mr-2 h-6 w-6"}),"Важно"]})}),(0,a.jsxs)(c.Wu,{className:"space-y-2 text-sm text-foreground/80",children:[s.system_os&&(0,a.jsxs)("p",{children:[(0,a.jsx)("strong",{className:"text-foreground/90",children:"Система:"})," ",s.system_os]}),s.system_build&&(0,a.jsxs)("p",{children:[(0,a.jsx)("strong",{className:"text-foreground/90",children:"Сборка:"})," ",s.system_build]}),s.system_gpu&&(0,a.jsxs)("p",{children:[(0,a.jsx)("strong",{className:"text-foreground/90",children:"Видеокарта:"})," ",s.system_gpu]}),s.system_cpu&&(0,a.jsxs)("p",{children:[(0,a.jsx)("strong",{className:"text-foreground/90",children:"Процессор:"})," ",s.system_cpu]}),!s.system_os&&!s.system_build&&!s.system_gpu&&!s.system_cpu&&(0,a.jsx)("p",{className:"text-muted-foreground",children:"Требования к системе не указаны."})]})]})]})})]})]})}},73158:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});let a=(0,s(40157).A)("ChevronRight",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]])},73672:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});let a=(0,s(40157).A)("Send",[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]])},85057:(e,t,s)=>{"use strict";s.d(t,{Label:()=>d});var a=s(95155),r=s(12115),l=s(40968),i=s(74466),n=s(59434);let c=(0,i.F)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),d=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)(l.b,{ref:t,className:(0,n.cn)(c(),s),...r})});d.displayName=l.b.displayName},87481:(e,t,s)=>{"use strict";s.d(t,{dj:()=>u});var a=s(12115);let r=0,l=new Map,i=e=>{if(l.has(e))return;let t=setTimeout(()=>{l.delete(e),o({type:"REMOVE_TOAST",toastId:e})},1e6);l.set(e,t)},n=(e,t)=>{switch(t.type){case"ADD_TOAST":return{...e,toasts:[t.toast,...e.toasts].slice(0,1)};case"UPDATE_TOAST":return{...e,toasts:e.toasts.map(e=>e.id===t.toast.id?{...e,...t.toast}:e)};case"DISMISS_TOAST":{let{toastId:s}=t;return s?i(s):e.toasts.forEach(e=>{i(e.id)}),{...e,toasts:e.toasts.map(e=>e.id===s||void 0===s?{...e,open:!1}:e)}}case"REMOVE_TOAST":if(void 0===t.toastId)return{...e,toasts:[]};return{...e,toasts:e.toasts.filter(e=>e.id!==t.toastId)}}},c=[],d={toasts:[]};function o(e){d=n(d,e),c.forEach(e=>{e(d)})}function m(e){let{...t}=e,s=(r=(r+1)%Number.MAX_SAFE_INTEGER).toString(),a=()=>o({type:"DISMISS_TOAST",toastId:s});return o({type:"ADD_TOAST",toast:{...t,id:s,open:!0,onOpenChange:e=>{e||a()}}}),{id:s,dismiss:a,update:e=>o({type:"UPDATE_TOAST",toast:{...e,id:s}})}}function u(){let[e,t]=a.useState(d);return a.useEffect(()=>(c.push(t),()=>{let e=c.indexOf(t);e>-1&&c.splice(e,1)}),[e]),{...e,toast:m,dismiss:e=>o({type:"DISMISS_TOAST",toastId:e})}}},88539:(e,t,s)=>{"use strict";s.d(t,{T:()=>i});var a=s(95155),r=s(12115),l=s(59434);let i=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)("textarea",{className:(0,l.cn)("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",s),ref:t,...r})});i.displayName="Textarea"},91118:(e,t,s)=>{Promise.resolve().then(s.bind(s,66435)),Promise.resolve().then(s.bind(s,40283))},94063:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});let a=(0,s(40157).A)("MessageSquare",[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",key:"1lielz"}]])},94394:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});let a=(0,s(40157).A)("Ticket",[["path",{d:"M2 9a3 3 0 0 1 0 6v2a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-2a3 3 0 0 1 0-6V7a2 2 0 0 0-2-2H4a2 2 0 0 0-2 2Z",key:"qn84l0"}],["path",{d:"M13 5v2",key:"dyzc3o"}],["path",{d:"M13 17v2",key:"1ont0d"}],["path",{d:"M13 11v2",key:"1wjjxi"}]])},94815:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});let a=(0,s(40157).A)("ShoppingCart",[["circle",{cx:"8",cy:"21",r:"1",key:"jimo8o"}],["circle",{cx:"19",cy:"21",r:"1",key:"13723u"}],["path",{d:"M2.05 2.05h2l2.66 12.42a2 2 0 0 0 2 1.58h9.78a2 2 0 0 0 1.95-1.57l1.65-7.43H5.12",key:"9zh506"}]])},98328:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});let a=(0,s(40157).A)("CalendarDays",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}],["path",{d:"M8 14h.01",key:"6423bh"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M16 14h.01",key:"1gbofw"}],["path",{d:"M8 18h.01",key:"lrp35t"}],["path",{d:"M12 18h.01",key:"mhygvu"}],["path",{d:"M16 18h.01",key:"kzsmim"}]])}},e=>{var t=t=>e(e.s=t);e.O(0,[4277,7576,5521,5756,6874,3063,5452,7252,8441,1684,7358],()=>t(91118)),_N_E=e.O()}]);