(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4311],{19637:(e,t,s)=>{"use strict";s.d(t,{A:()=>r});let r=(0,s(40157).A)("Mail",[["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}]])},30285:(e,t,s)=>{"use strict";s.d(t,{$:()=>d,r:()=>n});var r=s(95155),a=s(12115),l=s(99708),i=s(74466),o=s(59434);let n=(0,i.F)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-primary bg-transparent text-primary hover:bg-primary/10 hover:text-primary/90",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),d=a.forwardRef((e,t)=>{let{className:s,variant:a,size:i,asChild:d=!1,...m}=e,c=d?l.DX:"button";return(0,r.jsx)(c,{className:(0,o.cn)(n({variant:a,size:i,className:s})),ref:t,...m})});d.displayName="Button"},59409:(e,t,s)=>{"use strict";s.d(t,{bq:()=>p,eb:()=>h,gC:()=>x,l6:()=>m,yv:()=>c});var r=s(95155),a=s(12115),l=s(31992),i=s(79556),o=s(77381),n=s(10518),d=s(59434);let m=l.bL;l.YJ;let c=l.WT,p=a.forwardRef((e,t)=>{let{className:s,children:a,...o}=e;return(0,r.jsxs)(l.l9,{ref:t,className:(0,d.cn)("flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",s),...o,children:[a,(0,r.jsx)(l.In,{asChild:!0,children:(0,r.jsx)(i.A,{className:"h-4 w-4 opacity-50"})})]})});p.displayName=l.l9.displayName;let f=a.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,r.jsx)(l.PP,{ref:t,className:(0,d.cn)("flex cursor-default items-center justify-center py-1",s),...a,children:(0,r.jsx)(o.A,{className:"h-4 w-4"})})});f.displayName=l.PP.displayName;let u=a.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,r.jsx)(l.wn,{ref:t,className:(0,d.cn)("flex cursor-default items-center justify-center py-1",s),...a,children:(0,r.jsx)(i.A,{className:"h-4 w-4"})})});u.displayName=l.wn.displayName;let x=a.forwardRef((e,t)=>{let{className:s,children:a,position:i="popper",...o}=e;return(0,r.jsx)(l.ZL,{children:(0,r.jsxs)(l.UC,{ref:t,className:(0,d.cn)("relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2","popper"===i&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",s),position:i,...o,children:[(0,r.jsx)(f,{}),(0,r.jsx)(l.LM,{className:(0,d.cn)("p-1","popper"===i&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:a}),(0,r.jsx)(u,{})]})})});x.displayName=l.UC.displayName,a.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,r.jsx)(l.JU,{ref:t,className:(0,d.cn)("py-1.5 pl-8 pr-2 text-sm font-semibold",s),...a})}).displayName=l.JU.displayName;let h=a.forwardRef((e,t)=>{let{className:s,children:a,...i}=e;return(0,r.jsxs)(l.q7,{ref:t,className:(0,d.cn)("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",s),...i,children:[(0,r.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,r.jsx)(l.VF,{children:(0,r.jsx)(n.A,{className:"h-4 w-4"})})}),(0,r.jsx)(l.p4,{children:a})]})});h.displayName=l.q7.displayName,a.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,r.jsx)(l.wv,{ref:t,className:(0,d.cn)("-mx-1 my-1 h-px bg-muted",s),...a})}).displayName=l.wv.displayName},59434:(e,t,s)=>{"use strict";s.d(t,{cn:()=>l});var r=s(52596),a=s(39688);function l(){for(var e=arguments.length,t=Array(e),s=0;s<e;s++)t[s]=arguments[s];return(0,a.QP)((0,r.$)(t))}},62523:(e,t,s)=>{"use strict";s.d(t,{p:()=>i});var r=s(95155),a=s(12115),l=s(59434);let i=a.forwardRef((e,t)=>{let{className:s,type:a,...i}=e;return(0,r.jsx)("input",{type:a,className:(0,l.cn)("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",s),ref:t,...i})});i.displayName="Input"},66695:(e,t,s)=>{"use strict";s.d(t,{BT:()=>d,Wu:()=>m,ZB:()=>n,Zp:()=>i,aR:()=>o,wL:()=>c});var r=s(95155),a=s(12115),l=s(59434);let i=a.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,r.jsx)("div",{ref:t,className:(0,l.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",s),...a})});i.displayName="Card";let o=a.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,r.jsx)("div",{ref:t,className:(0,l.cn)("flex flex-col space-y-1.5 p-6",s),...a})});o.displayName="CardHeader";let n=a.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,r.jsx)("h3",{ref:t,className:(0,l.cn)("text-xl font-normal uppercase tracking-wider leading-none",s),...a})});n.displayName="CardTitle";let d=a.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,r.jsx)("p",{ref:t,className:(0,l.cn)("text-sm text-muted-foreground",s),...a})});d.displayName="CardDescription";let m=a.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,r.jsx)("div",{ref:t,className:(0,l.cn)("p-6 pt-0",s),...a})});m.displayName="CardContent";let c=a.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,r.jsx)("div",{ref:t,className:(0,l.cn)("flex items-center p-6 pt-0",s),...a})});c.displayName="CardFooter"},68781:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>y});var r=s(95155),a=s(12115),l=s(62177),i=s(90221),o=s(55594),n=s(66695),d=s(62523),m=s(85057),c=s(30285),p=s(59409),f=s(50172),u=s(19637),x=s(73672),h=s(87481);let g=o.Ik({smtp_host:o.Yj().optional().nullable(),smtp_port:o.au.number().positive("Порт должен быть положительным числом.").optional().nullable(),smtp_username:o.Yj().optional().nullable(),smtp_password:o.Yj().optional().nullable(),smtp_encryption:o.k5(["none","ssl","tls"]).nullable().optional().default("none"),from_email:o.Yj().email({message:"Неверный формат Email отправителя."}).optional().nullable().or(o.eu("")),from_name:o.Yj().optional().nullable()});function y(){let{toast:e}=(0,h.dj)(),[t,s]=(0,a.useState)(!1),[o,y]=(0,a.useState)(!0),[b,j]=(0,a.useState)(""),[v,N]=(0,a.useState)(!1),_=(0,l.mN)({resolver:(0,i.u)(g),defaultValues:{smtp_host:"",smtp_port:587,smtp_username:"",smtp_password:"",smtp_encryption:"tls",from_email:"",from_name:""}}),w=(0,a.useCallback)(async()=>{y(!0);try{let e=await fetch("/api/admin/site-settings/smtp");if(!e.ok){let t=await e.json().catch(()=>({message:"Failed to fetch SMTP settings"}));throw Error(t.message||"Failed to fetch SMTP settings")}let t=await e.json();_.reset({smtp_host:t.smtp_host||"",smtp_port:null!==t.smtp_port?Number(t.smtp_port):587,smtp_username:t.smtp_username||"",smtp_password:"",smtp_encryption:t.smtp_encryption||"none",from_email:t.from_email||"",from_name:t.from_name||""})}catch(t){e({title:"Ошибка загрузки SMTP",description:t.message,variant:"destructive"})}finally{y(!1)}},[_,e]);(0,a.useEffect)(()=>{w()},[w]);let S=async t=>{s(!0);let r={...t};r.smtp_password||delete r.smtp_password;try{let t=await fetch("/api/admin/site-settings/smtp",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)}),s=await t.json();if(!t.ok)throw Error(s.message||"Не удалось сохранить SMTP настройки.");e({title:"SMTP Настройки сохранены",description:"Конфигурация SMTP успешно обновлена."}),await w()}catch(t){e({title:"Ошибка сохранения SMTP",description:t.message,variant:"destructive"})}finally{s(!1)}},T=async()=>{if(!b){e({title:"Ошибка",description:"Введите Email получателя для тестового письма.",variant:"destructive"});return}if(!_.getValues("smtp_host")||!_.getValues("smtp_port")){e({title:"Ошибка",description:"Для отправки тестового письма необходимо сохранить основные SMTP настройки (хост и порт).",variant:"destructive"});return}N(!0);try{let t=await fetch("/api/admin/site-settings/smtp/test-email",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({recipientEmail:b})}),s=await t.json();if(!t.ok)throw Error(s.message||"Не удалось отправить тестовое письмо.");e({title:"Тестовое письмо",description:s.message})}catch(t){e({title:"Ошибка тестового письма",description:t.message,variant:"destructive"})}finally{N(!1)}};return o?(0,r.jsxs)("div",{className:"flex items-center justify-center p-10",children:[(0,r.jsx)(f.A,{className:"h-8 w-8 animate-spin text-primary"}),(0,r.jsx)("p",{className:"ml-3 text-muted-foreground",children:"Загрузка SMTP настроек..."})]}):(0,r.jsxs)(n.Zp,{className:"shadow-lg",children:[(0,r.jsxs)(n.aR,{children:[(0,r.jsxs)(n.ZB,{className:"text-xl font-bold text-primary flex items-center",children:[(0,r.jsx)(u.A,{className:"mr-2 h-5 w-5"}),"Настройки SMTP"]}),(0,r.jsx)(n.BT,{className:"text-muted-foreground",children:"Конфигурация сервера для отправки email-уведомлений."})]}),(0,r.jsxs)(n.Wu,{children:[(0,r.jsxs)("form",{onSubmit:_.handleSubmit(S),className:"space-y-6",children:[(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)(m.Label,{htmlFor:"smtp_host",className:"text-foreground",children:"SMTP Хост"}),(0,r.jsx)(d.p,{id:"smtp_host",..._.register("smtp_host"),placeholder:"smtp.example.com",className:"mt-1",disabled:t}),_.formState.errors.smtp_host&&(0,r.jsx)("p",{className:"text-sm text-destructive mt-1",children:_.formState.errors.smtp_host.message})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)(m.Label,{htmlFor:"smtp_port",className:"text-foreground",children:"SMTP Порт"}),(0,r.jsx)(d.p,{id:"smtp_port",type:"number",..._.register("smtp_port"),placeholder:"587",className:"mt-1",disabled:t}),_.formState.errors.smtp_port&&(0,r.jsx)("p",{className:"text-sm text-destructive mt-1",children:_.formState.errors.smtp_port.message})]})]}),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)(m.Label,{htmlFor:"smtp_username",className:"text-foreground",children:"SMTP Имя пользователя"}),(0,r.jsx)(d.p,{id:"smtp_username",..._.register("smtp_username"),placeholder:"user@example.com",className:"mt-1",disabled:t}),_.formState.errors.smtp_username&&(0,r.jsx)("p",{className:"text-sm text-destructive mt-1",children:_.formState.errors.smtp_username.message})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)(m.Label,{htmlFor:"smtp_password",className:"text-foreground",children:"SMTP Пароль"}),(0,r.jsx)(d.p,{id:"smtp_password",type:"password",..._.register("smtp_password"),placeholder:"•••••••• (оставьте пустым, чтобы не менять)",className:"mt-1",disabled:t}),_.formState.errors.smtp_password&&(0,r.jsx)("p",{className:"text-sm text-destructive mt-1",children:_.formState.errors.smtp_password.message})]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)(m.Label,{htmlFor:"smtp_encryption",className:"text-foreground",children:"Шифрование"}),(0,r.jsx)(l.xI,{control:_.control,name:"smtp_encryption",render:e=>{let{field:s}=e;return(0,r.jsxs)(p.l6,{onValueChange:s.onChange,value:s.value||"none",disabled:t,children:[(0,r.jsx)(p.bq,{className:"w-full mt-1",children:(0,r.jsx)(p.yv,{placeholder:"Выберите тип шифрования"})}),(0,r.jsxs)(p.gC,{children:[(0,r.jsx)(p.eb,{value:"none",children:"None"}),(0,r.jsx)(p.eb,{value:"ssl",children:"SSL"}),(0,r.jsx)(p.eb,{value:"tls",children:"TLS"})]})]})}}),_.formState.errors.smtp_encryption&&(0,r.jsx)("p",{className:"text-sm text-destructive mt-1",children:_.formState.errors.smtp_encryption.message})]}),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)(m.Label,{htmlFor:"from_email",className:"text-foreground",children:"Email отправителя"}),(0,r.jsx)(d.p,{id:"from_email",type:"email",..._.register("from_email"),placeholder:"noreply@example.com",className:"mt-1",disabled:t}),_.formState.errors.from_email&&(0,r.jsx)("p",{className:"text-sm text-destructive mt-1",children:_.formState.errors.from_email.message})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)(m.Label,{htmlFor:"from_name",className:"text-foreground",children:"Имя отправителя"}),(0,r.jsx)(d.p,{id:"from_name",..._.register("from_name"),placeholder:"Green Hack Support",className:"mt-1",disabled:t}),_.formState.errors.from_name&&(0,r.jsx)("p",{className:"text-sm text-destructive mt-1",children:_.formState.errors.from_name.message})]})]}),(0,r.jsx)("div",{className:"flex flex-col sm:flex-row gap-3 pt-4",children:(0,r.jsxs)(c.$,{type:"submit",className:"bg-primary hover:bg-primary/90 text-primary-foreground w-full sm:w-auto",disabled:t,children:[t&&(0,r.jsx)(f.A,{className:"mr-2 h-4 w-4 animate-spin"}),"Сохранить SMTP"]})})]}),(0,r.jsxs)("div",{className:"mt-8 pt-6 border-t border-border/30",children:[(0,r.jsx)("h4",{className:"text-md font-medium text-foreground mb-2",children:"Отправить тестовое письмо"}),(0,r.jsxs)("div",{className:"flex flex-col sm:flex-row gap-3",children:[(0,r.jsx)(d.p,{type:"email",placeholder:"recipient@example.com",value:b,onChange:e=>j(e.target.value),className:"flex-grow",disabled:v}),(0,r.jsxs)(c.$,{type:"button",variant:"outline",className:"w-full sm:w-auto border-primary text-primary hover:bg-primary/10",onClick:T,disabled:v||!b.trim()||!_.getValues("smtp_host")||!_.getValues("smtp_port"),children:[v?(0,r.jsx)(f.A,{className:"mr-2 h-4 w-4 animate-spin"}):(0,r.jsx)(x.A,{className:"mr-2 h-4 w-4"}),"Отправить тест"]})]}),(0,r.jsx)("p",{className:"text-xs text-muted-foreground mt-2",children:"Убедитесь, что основные SMTP настройки (хост, порт) сохранены перед отправкой теста."})]})]})]})}},72793:(e,t,s)=>{Promise.resolve().then(s.bind(s,68781))},73672:(e,t,s)=>{"use strict";s.d(t,{A:()=>r});let r=(0,s(40157).A)("Send",[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]])},85057:(e,t,s)=>{"use strict";s.d(t,{Label:()=>d});var r=s(95155),a=s(12115),l=s(40968),i=s(74466),o=s(59434);let n=(0,i.F)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),d=a.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,r.jsx)(l.b,{ref:t,className:(0,o.cn)(n(),s),...a})});d.displayName=l.b.displayName},87481:(e,t,s)=>{"use strict";s.d(t,{dj:()=>p});var r=s(12115);let a=0,l=new Map,i=e=>{if(l.has(e))return;let t=setTimeout(()=>{l.delete(e),m({type:"REMOVE_TOAST",toastId:e})},1e6);l.set(e,t)},o=(e,t)=>{switch(t.type){case"ADD_TOAST":return{...e,toasts:[t.toast,...e.toasts].slice(0,1)};case"UPDATE_TOAST":return{...e,toasts:e.toasts.map(e=>e.id===t.toast.id?{...e,...t.toast}:e)};case"DISMISS_TOAST":{let{toastId:s}=t;return s?i(s):e.toasts.forEach(e=>{i(e.id)}),{...e,toasts:e.toasts.map(e=>e.id===s||void 0===s?{...e,open:!1}:e)}}case"REMOVE_TOAST":if(void 0===t.toastId)return{...e,toasts:[]};return{...e,toasts:e.toasts.filter(e=>e.id!==t.toastId)}}},n=[],d={toasts:[]};function m(e){d=o(d,e),n.forEach(e=>{e(d)})}function c(e){let{...t}=e,s=(a=(a+1)%Number.MAX_SAFE_INTEGER).toString(),r=()=>m({type:"DISMISS_TOAST",toastId:s});return m({type:"ADD_TOAST",toast:{...t,id:s,open:!0,onOpenChange:e=>{e||r()}}}),{id:s,dismiss:r,update:e=>m({type:"UPDATE_TOAST",toast:{...e,id:s}})}}function p(){let[e,t]=r.useState(d);return r.useEffect(()=>(n.push(t),()=>{let e=n.indexOf(t);e>-1&&n.splice(e,1)}),[e]),{...e,toast:c,dismiss:e=>m({type:"DISMISS_TOAST",toastId:e})}}}},e=>{var t=t=>e(e.s=t);e.O(0,[4277,7576,5521,5756,9205,8897,8441,1684,7358],()=>t(72793)),_N_E=e.O()}]);