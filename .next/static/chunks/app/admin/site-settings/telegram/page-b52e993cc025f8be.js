(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2836],{17313:(e,t,i)=>{"use strict";i.d(t,{Xi:()=>l,av:()=>c,j7:()=>d,tU:()=>o});var a=i(95155),s=i(12115),n=i(30064),r=i(59434);let o=n.bL,d=s.forwardRef((e,t)=>{let{className:i,...s}=e;return(0,a.jsx)(n.B8,{ref:t,className:(0,r.cn)("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",i),...s})});d.displayName=n.B8.displayName;let l=s.forwardRef((e,t)=>{let{className:i,...s}=e;return(0,a.jsx)(n.l9,{ref:t,className:(0,r.cn)("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm",i),...s})});l.displayName=n.l9.displayName;let c=s.forwardRef((e,t)=>{let{className:i,...s}=e;return(0,a.jsx)(n.UC,{ref:t,className:(0,r.cn)("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",i),...s})});c.displayName=n.UC.displayName},22346:(e,t,i)=>{"use strict";i.d(t,{Separator:()=>o});var a=i(95155),s=i(12115),n=i(87489),r=i(59434);let o=s.forwardRef((e,t)=>{let{className:i,orientation:s="horizontal",decorative:o=!0,...d}=e;return(0,a.jsx)(n.b,{ref:t,decorative:o,orientation:s,className:(0,r.cn)("shrink-0 bg-border","horizontal"===s?"h-[1px] w-full":"h-full w-[1px]",i),...d})});o.displayName=n.b.displayName},26646:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>T});var a=i(95155),s=i(12115),n=i(62177),r=i(90221),o=i(55594),d=i(66695),l=i(30285),c=i(62523),m=i(85057),u=i(47262),_=i(17313),f=i(88390),p=i(94815),g=i(94063),b=i(28044),h=i(50172),x=i(73503),v=i(73672),y=i(87481),j=i(22346),N=i(46102);let w=o.Ik({client_bot_token:o.Yj().optional().nullable(),client_bot_chat_id:o.Yj().optional().nullable(),admin_bot_token:o.Yj().optional().nullable(),admin_bot_chat_ids:o.Yj().optional().nullable()}),k=o.Ik({notify_admin_on_balance_deposit:o.zM().default(!1),notify_admin_on_product_purchase:o.zM().default(!1),notify_admin_on_promo_code_creation:o.zM().default(!1),notify_admin_on_admin_login:o.zM().default(!1)}),S=[{id:"notify_admin_on_balance_deposit",label:"Пополнение баланса",description:"Уведомлять о пополнении баланса пользователем (включая промокоды).",icon:f.A,implemented:!0},{id:"notify_admin_on_product_purchase",label:"Покупка товара",description:"Уведомлять о покупке товара пользователем.",icon:p.A,implemented:!0},{id:"notify_admin_on_promo_code_creation",label:"Создание промокода",description:"Уведомлять о создании нового промокода.",icon:g.A,implemented:!0},{id:"notify_admin_on_admin_login",label:"Вход в админ-панель",description:"Уведомлять о входе в админ-панель. (Требуется доп. интеграция)",icon:b.A,implemented:!1}];function T(){let{toast:e}=(0,y.dj)(),[t,i]=(0,s.useState)(!1),[o,f]=(0,s.useState)(!0),[p,g]=(0,s.useState)(""),[b,T]=(0,s.useState)(""),[A,C]=(0,s.useState)(!1),[I,E]=(0,s.useState)(!1),R=(0,n.mN)({resolver:(0,r.u)(w.merge(k)),defaultValues:{client_bot_token:"",client_bot_chat_id:"",admin_bot_token:"",admin_bot_chat_ids:"",notify_admin_on_balance_deposit:!1,notify_admin_on_product_purchase:!1,notify_admin_on_promo_code_creation:!1,notify_admin_on_admin_login:!1}}),O=(0,s.useCallback)(async()=>{f(!0);try{var t,i,a,s,n,r,o,d;let e=await fetch("/api/admin/site-settings/telegram");if(!e.ok){let t=await e.json().catch(()=>({message:"Failed to fetch Telegram settings"}));throw Error(t.message||"Failed to fetch Telegram settings")}let l=await e.json();R.reset({client_bot_token:(null===(t=l.telegramSettings)||void 0===t?void 0:t.client_bot_token)||"",client_bot_chat_id:(null===(i=l.telegramSettings)||void 0===i?void 0:i.client_bot_chat_id)||"",admin_bot_token:(null===(a=l.telegramSettings)||void 0===a?void 0:a.admin_bot_token)||"",admin_bot_chat_ids:(null===(s=l.telegramSettings)||void 0===s?void 0:s.admin_bot_chat_ids)||"",notify_admin_on_balance_deposit:(null===(n=l.notificationPrefs)||void 0===n?void 0:n.notify_admin_on_balance_deposit)||!1,notify_admin_on_product_purchase:(null===(r=l.notificationPrefs)||void 0===r?void 0:r.notify_admin_on_product_purchase)||!1,notify_admin_on_promo_code_creation:(null===(o=l.notificationPrefs)||void 0===o?void 0:o.notify_admin_on_promo_code_creation)||!1,notify_admin_on_admin_login:(null===(d=l.notificationPrefs)||void 0===d?void 0:d.notify_admin_on_admin_login)||!1})}catch(t){e({title:"Ошибка загрузки Telegram настроек",description:t.message,variant:"destructive"})}finally{f(!1)}},[R,e]);(0,s.useEffect)(()=>{O()},[O]);let D=async t=>{i(!0);try{let i=await fetch("/api/admin/site-settings/telegram",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}),m=await i.json();if(!i.ok)throw Error(m.message||"Не удалось сохранить Telegram настройки.");if(e({title:"Telegram Настройки сохранены",description:"Конфигурация Telegram ботов успешно обновлена."}),m.settings){var a,s,n,r,o,d,l,c;R.reset({client_bot_token:(null===(a=m.settings.telegramSettings)||void 0===a?void 0:a.client_bot_token)||"",client_bot_chat_id:(null===(s=m.settings.telegramSettings)||void 0===s?void 0:s.client_bot_chat_id)||"",admin_bot_token:(null===(n=m.settings.telegramSettings)||void 0===n?void 0:n.admin_bot_token)||"",admin_bot_chat_ids:(null===(r=m.settings.telegramSettings)||void 0===r?void 0:r.admin_bot_chat_ids)||"",notify_admin_on_balance_deposit:(null===(o=m.settings.notificationPrefs)||void 0===o?void 0:o.notify_admin_on_balance_deposit)||!1,notify_admin_on_product_purchase:(null===(d=m.settings.notificationPrefs)||void 0===d?void 0:d.notify_admin_on_product_purchase)||!1,notify_admin_on_promo_code_creation:(null===(l=m.settings.notificationPrefs)||void 0===l?void 0:l.notify_admin_on_promo_code_creation)||!1,notify_admin_on_admin_login:(null===(c=m.settings.notificationPrefs)||void 0===c?void 0:c.notify_admin_on_admin_login)||!1})}}catch(t){e({title:"Ошибка сохранения Telegram",description:t.message,variant:"destructive"})}finally{i(!1)}},F=async(t,i)=>{var a,s;if(!i.trim()){e({title:"Ошибка",description:"Введите текст сообщения.",variant:"destructive"});return}let n="client"===t?R.getValues("client_bot_token"):R.getValues("admin_bot_token"),r="client"===t?R.getValues("client_bot_chat_id"):null===(s=R.getValues("admin_bot_chat_ids"))||void 0===s?void 0:null===(a=s.split(",")[0])||void 0===a?void 0:a.trim();if(!n||!r){e({title:"Ошибка",description:"Токен бота и ID чата должны быть заполнены для отправки тестового сообщения.",variant:"destructive"});return}"client"===t?C(!0):E(!0);try{let a=await fetch("/api/admin/site-settings/telegram/test-message",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({botType:t,message:i})}),s=await a.json();if(!a.ok)throw Error(s.message||"Не удалось отправить тестовое сообщение для ".concat("client"===t?"клиентского":"админского"," бота."));e({title:"Тестовое сообщение",description:s.message})}catch(t){e({title:"Ошибка отправки",description:t.message,variant:"destructive"})}finally{"client"===t?C(!1):E(!1)}};return o?(0,a.jsxs)("div",{className:"flex items-center justify-center p-10",children:[(0,a.jsx)(h.A,{className:"h-8 w-8 animate-spin text-primary"}),(0,a.jsx)("p",{className:"ml-3 text-muted-foreground",children:"Загрузка настроек Telegram..."})]}):(0,a.jsxs)(d.Zp,{className:"shadow-lg",children:[(0,a.jsxs)(d.aR,{children:[(0,a.jsxs)(d.ZB,{className:"text-xl font-bold text-primary flex items-center",children:[(0,a.jsx)(x.A,{className:"mr-2 h-5 w-5"}),"Настройки Telegram Ботов"]}),(0,a.jsx)(d.BT,{className:"text-muted-foreground",children:"Управление ботами для клиентских и административных уведомлений."})]}),(0,a.jsx)(d.Wu,{children:(0,a.jsxs)("form",{onSubmit:R.handleSubmit(D),children:[(0,a.jsxs)(_.tU,{defaultValue:"client_bot",className:"w-full",children:[(0,a.jsxs)(_.j7,{className:"grid w-full grid-cols-2 mb-6",children:[(0,a.jsx)(_.Xi,{value:"client_bot",children:"Клиентский Бот"}),(0,a.jsx)(_.Xi,{value:"admin_bot",children:"Админский Бот"})]}),(0,a.jsxs)(_.av,{value:"client_bot",className:"space-y-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)(m.Label,{htmlFor:"client_bot_token",className:"text-foreground",children:"Токен Клиентского Бота"}),(0,a.jsx)(c.p,{id:"client_bot_token",...R.register("client_bot_token"),placeholder:"123456:ABC-DEF1234ghIkl-zyx57W2v1u123ew11",className:"mt-1",disabled:t})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(m.Label,{htmlFor:"client_bot_chat_id",className:"text-foreground",children:"ID Канала/Чата Клиентского Бота"}),(0,a.jsx)(c.p,{id:"client_bot_chat_id",...R.register("client_bot_chat_id"),placeholder:"-1001234567890 или @channelname",className:"mt-1",disabled:t})]}),(0,a.jsxs)("div",{className:"pt-2 space-y-2",children:[(0,a.jsx)(m.Label,{htmlFor:"test_message_client",className:"text-foreground",children:"Тестовое сообщение для клиентского бота"}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)(c.p,{id:"test_message_client",value:p,onChange:e=>g(e.target.value),placeholder:"Тест клиентского бота!",disabled:A}),(0,a.jsxs)(l.$,{type:"button",variant:"outline",onClick:()=>F("client",p),disabled:A||!R.getValues("client_bot_token")||!R.getValues("client_bot_chat_id"),className:"border-primary text-primary hover:bg-primary/10",children:[A?(0,a.jsx)(h.A,{className:"mr-2 h-4 w-4 animate-spin"}):(0,a.jsx)(v.A,{className:"mr-2 h-4 w-4"}),"Отправить"]})]})]})]}),(0,a.jsxs)(_.av,{value:"admin_bot",className:"space-y-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)(m.Label,{htmlFor:"admin_bot_token",className:"text-foreground",children:"Токен Админского Бота"}),(0,a.jsx)(c.p,{id:"admin_bot_token",...R.register("admin_bot_token"),placeholder:"654321:ZYX-wvu9876...",className:"mt-1",disabled:t})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(m.Label,{htmlFor:"admin_bot_chat_ids",className:"text-foreground",children:"ID Чатов Администраторов (через запятую)"}),(0,a.jsx)(c.p,{id:"admin_bot_chat_ids",...R.register("admin_bot_chat_ids"),placeholder:"-100987654321, -1001122334455",className:"mt-1",disabled:t})]}),(0,a.jsxs)("div",{className:"pt-2 space-y-2",children:[(0,a.jsx)(m.Label,{htmlFor:"test_message_admin",className:"text-foreground",children:"Тестовое сообщение для админского бота"}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)(c.p,{id:"test_message_admin",value:b,onChange:e=>T(e.target.value),placeholder:"Тест админского бота!",disabled:I}),(0,a.jsxs)(l.$,{type:"button",variant:"outline",onClick:()=>F("admin",b),disabled:I||!R.getValues("admin_bot_token")||!R.getValues("admin_bot_chat_ids"),className:"border-primary text-primary hover:bg-primary/10",children:[I?(0,a.jsx)(h.A,{className:"mr-2 h-4 w-4 animate-spin"}):(0,a.jsx)(v.A,{className:"mr-2 h-4 w-4"}),"Отправить"]})]})]}),(0,a.jsx)(j.Separator,{}),(0,a.jsx)("h4",{className:"text-md font-medium text-foreground",children:"Уведомления для Админского Бота:"}),(0,a.jsx)("div",{className:"space-y-3",children:S.map(e=>(0,a.jsxs)("div",{className:"flex items-start p-2.5 border border-border/30 rounded-md bg-muted/20 hover:bg-muted/30 transition-colors",children:[(0,a.jsx)(n.xI,{control:R.control,name:e.id,render:i=>{let{field:s}=i;return(0,a.jsx)(N.Bc,{children:(0,a.jsxs)(N.m_,{delayDuration:100,children:[(0,a.jsx)(N.k$,{asChild:!0,children:(0,a.jsx)("div",{className:"flex items-center",children:(0,a.jsx)(u.S,{id:e.id,checked:s.value,onCheckedChange:s.onChange,className:"mt-1 mr-3 border-primary data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground",disabled:t||!e.implemented})})}),!e.implemented&&(0,a.jsx)(N.ZI,{side:"right",children:(0,a.jsx)("p",{children:"Функция в разработке"})})]})})}}),(0,a.jsxs)("div",{className:"grid gap-1 leading-none",children:[(0,a.jsxs)(m.Label,{htmlFor:e.id,className:"text-foreground font-medium flex items-center ".concat(e.implemented?"cursor-pointer":"cursor-not-allowed opacity-60"),children:[(0,a.jsx)(e.icon,{className:"mr-2 h-4 w-4 ".concat(e.implemented?"text-primary/80":"text-muted-foreground")}),e.label]}),(0,a.jsx)("p",{className:"text-xs text-muted-foreground",children:e.description})]})]},e.id))})]})]}),(0,a.jsx)("div",{className:"flex justify-end pt-6 border-t border-border/50 mt-6",children:(0,a.jsxs)(l.$,{type:"submit",className:"bg-primary hover:bg-primary/90 text-primary-foreground",disabled:t||o,children:[t&&(0,a.jsx)(h.A,{className:"mr-2 h-4 w-4 animate-spin"}),"Сохранить настройки Telegram"]})})]})})]})}},30285:(e,t,i)=>{"use strict";i.d(t,{$:()=>l,r:()=>d});var a=i(95155),s=i(12115),n=i(99708),r=i(74466),o=i(59434);let d=(0,r.F)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-primary bg-transparent text-primary hover:bg-primary/10 hover:text-primary/90",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),l=s.forwardRef((e,t)=>{let{className:i,variant:s,size:r,asChild:l=!1,...c}=e,m=l?n.DX:"button";return(0,a.jsx)(m,{className:(0,o.cn)(d({variant:s,size:r,className:i})),ref:t,...c})});l.displayName="Button"},46102:(e,t,i)=>{"use strict";i.d(t,{Bc:()=>o,ZI:()=>c,k$:()=>l,m_:()=>d});var a=i(95155),s=i(12115),n=i(89613),r=i(59434);let o=e=>{let{delayDuration:t=300,...i}=e;return(0,a.jsx)(n.Kq,{delayDuration:t,...i})};o.displayName=n.Kq.displayName;let d=n.bL,l=n.l9,c=s.forwardRef((e,t)=>{let{className:i,sideOffset:s=4,...o}=e;return(0,a.jsx)(n.UC,{ref:t,sideOffset:s,className:(0,r.cn)("z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",i),...o})});c.displayName=n.UC.displayName},47262:(e,t,i)=>{"use strict";i.d(t,{S:()=>d});var a=i(95155),s=i(12115),n=i(76981),r=i(10518),o=i(59434);let d=s.forwardRef((e,t)=>{let{className:i,...s}=e;return(0,a.jsx)(n.bL,{ref:t,className:(0,o.cn)("peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground",i),...s,children:(0,a.jsx)(n.C1,{className:(0,o.cn)("flex items-center justify-center text-current"),children:(0,a.jsx)(r.A,{className:"h-4 w-4"})})})});d.displayName=n.bL.displayName},59434:(e,t,i)=>{"use strict";i.d(t,{cn:()=>n});var a=i(52596),s=i(39688);function n(){for(var e=arguments.length,t=Array(e),i=0;i<e;i++)t[i]=arguments[i];return(0,s.QP)((0,a.$)(t))}},62523:(e,t,i)=>{"use strict";i.d(t,{p:()=>r});var a=i(95155),s=i(12115),n=i(59434);let r=s.forwardRef((e,t)=>{let{className:i,type:s,...r}=e;return(0,a.jsx)("input",{type:s,className:(0,n.cn)("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",i),ref:t,...r})});r.displayName="Input"},66695:(e,t,i)=>{"use strict";i.d(t,{BT:()=>l,Wu:()=>c,ZB:()=>d,Zp:()=>r,aR:()=>o,wL:()=>m});var a=i(95155),s=i(12115),n=i(59434);let r=s.forwardRef((e,t)=>{let{className:i,...s}=e;return(0,a.jsx)("div",{ref:t,className:(0,n.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",i),...s})});r.displayName="Card";let o=s.forwardRef((e,t)=>{let{className:i,...s}=e;return(0,a.jsx)("div",{ref:t,className:(0,n.cn)("flex flex-col space-y-1.5 p-6",i),...s})});o.displayName="CardHeader";let d=s.forwardRef((e,t)=>{let{className:i,...s}=e;return(0,a.jsx)("h3",{ref:t,className:(0,n.cn)("text-xl font-normal uppercase tracking-wider leading-none",i),...s})});d.displayName="CardTitle";let l=s.forwardRef((e,t)=>{let{className:i,...s}=e;return(0,a.jsx)("p",{ref:t,className:(0,n.cn)("text-sm text-muted-foreground",i),...s})});l.displayName="CardDescription";let c=s.forwardRef((e,t)=>{let{className:i,...s}=e;return(0,a.jsx)("div",{ref:t,className:(0,n.cn)("p-6 pt-0",i),...s})});c.displayName="CardContent";let m=s.forwardRef((e,t)=>{let{className:i,...s}=e;return(0,a.jsx)("div",{ref:t,className:(0,n.cn)("flex items-center p-6 pt-0",i),...s})});m.displayName="CardFooter"},69520:(e,t,i)=>{Promise.resolve().then(i.bind(i,26646))},85057:(e,t,i)=>{"use strict";i.d(t,{Label:()=>l});var a=i(95155),s=i(12115),n=i(40968),r=i(74466),o=i(59434);let d=(0,r.F)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),l=s.forwardRef((e,t)=>{let{className:i,...s}=e;return(0,a.jsx)(n.b,{ref:t,className:(0,o.cn)(d(),i),...s})});l.displayName=n.b.displayName},87481:(e,t,i)=>{"use strict";i.d(t,{dj:()=>u});var a=i(12115);let s=0,n=new Map,r=e=>{if(n.has(e))return;let t=setTimeout(()=>{n.delete(e),c({type:"REMOVE_TOAST",toastId:e})},1e6);n.set(e,t)},o=(e,t)=>{switch(t.type){case"ADD_TOAST":return{...e,toasts:[t.toast,...e.toasts].slice(0,1)};case"UPDATE_TOAST":return{...e,toasts:e.toasts.map(e=>e.id===t.toast.id?{...e,...t.toast}:e)};case"DISMISS_TOAST":{let{toastId:i}=t;return i?r(i):e.toasts.forEach(e=>{r(e.id)}),{...e,toasts:e.toasts.map(e=>e.id===i||void 0===i?{...e,open:!1}:e)}}case"REMOVE_TOAST":if(void 0===t.toastId)return{...e,toasts:[]};return{...e,toasts:e.toasts.filter(e=>e.id!==t.toastId)}}},d=[],l={toasts:[]};function c(e){l=o(l,e),d.forEach(e=>{e(l)})}function m(e){let{...t}=e,i=(s=(s+1)%Number.MAX_SAFE_INTEGER).toString(),a=()=>c({type:"DISMISS_TOAST",toastId:i});return c({type:"ADD_TOAST",toast:{...t,id:i,open:!0,onOpenChange:e=>{e||a()}}}),{id:i,dismiss:a,update:e=>c({type:"UPDATE_TOAST",toast:{...e,id:i}})}}function u(){let[e,t]=a.useState(l);return a.useEffect(()=>(d.push(t),()=>{let e=d.indexOf(t);e>-1&&d.splice(e,1)}),[e]),{...e,toast:m,dismiss:e=>c({type:"DISMISS_TOAST",toastId:e})}}}},e=>{var t=t=>e(e.s=t);e.O(0,[4277,7576,5521,9205,9613,9889,8441,1684,7358],()=>t(69520)),_N_E=e.O()}]);