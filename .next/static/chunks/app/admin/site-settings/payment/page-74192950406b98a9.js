(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5743],{12845:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>k});var o=s(95155),r=s(12115),a=s(62177),n=s(90221),i=s(55594),d=s(66695),l=s(62523),c=s(85057),m=s(30285),y=s(47262),u=s(17313),f=s(10518),p=s(50172),_=s(25318),x=s(82734),g=s(6160),h=s(86318),b=s(50594),v=s(87481),N=s(22346);let j=i.Ik({yoomoney_shop_id:i.Yj().optional().nullable(),yoomoney_secret_key:i.Yj().optional().nullable(),yoomoney_notify_payment_succeeded:i.zM().default(!0),yoomoney_notify_payment_waiting_for_capture:i.zM().default(!1),yoomoney_notify_payment_canceled:i.zM().default(!0),yoomoney_notify_refund_succeeded:i.zM().default(!0),is_test_mode_active:i.zM().default(!0)}),w=[{id:"yoomoney_notify_payment_succeeded",label:"Успешный платеж",description:"Уведомление о полностью успешном платеже.",eventName:"payment.succeeded",icon:f.A},{id:"yoomoney_notify_payment_waiting_for_capture",label:"Платеж ожидает подтверждения",description:"Платеж создан, ожидает захвата (capture).",eventName:"payment.waiting_for_capture",icon:p.A},{id:"yoomoney_notify_payment_canceled",label:"Отмена/Ошибка платежа",description:"Платеж отменен или произошла ошибка при оплате.",eventName:"payment.canceled",icon:_.A},{id:"yoomoney_notify_refund_succeeded",label:"Успешный возврат",description:"Уведомление об успешном возврате средств покупателю.",eventName:"refund.succeeded",icon:x.A}];function k(){let{toast:e}=(0,v.dj)(),[t,s]=(0,r.useState)(!1),[i,_]=(0,r.useState)(!0),[x,k]=(0,r.useState)(""),S=(0,a.mN)({resolver:(0,n.u)(j),defaultValues:{yoomoney_shop_id:"",yoomoney_secret_key:"",yoomoney_notify_payment_succeeded:!0,yoomoney_notify_payment_waiting_for_capture:!1,yoomoney_notify_payment_canceled:!0,yoomoney_notify_refund_succeeded:!0,is_test_mode_active:!0}});(0,r.useEffect)(()=>{k(window.location.origin)},[]);let T=(0,r.useCallback)(async()=>{_(!0);try{let e=await fetch("/api/admin/site-settings/payment");if(!e.ok){let t=await e.json().catch(()=>({message:"Failed to fetch payment settings"}));throw Error(t.message)}let t=await e.json();S.reset({yoomoney_shop_id:t.yoomoney_shop_id||"",yoomoney_secret_key:"",yoomoney_notify_payment_succeeded:void 0===t.yoomoney_notify_payment_succeeded||t.yoomoney_notify_payment_succeeded,yoomoney_notify_payment_waiting_for_capture:void 0!==t.yoomoney_notify_payment_waiting_for_capture&&t.yoomoney_notify_payment_waiting_for_capture,yoomoney_notify_payment_canceled:void 0===t.yoomoney_notify_payment_canceled||t.yoomoney_notify_payment_canceled,yoomoney_notify_refund_succeeded:void 0===t.yoomoney_notify_refund_succeeded||t.yoomoney_notify_refund_succeeded,is_test_mode_active:void 0===t.is_test_mode_active||t.is_test_mode_active})}catch(t){e({title:"Ошибка загрузки настроек",description:t.message,variant:"destructive"})}finally{_(!1)}},[S,e]);(0,r.useEffect)(()=>{T()},[T]);let A=async t=>{s(!0);let o={...t};t.yoomoney_secret_key&&""!==t.yoomoney_secret_key.trim()||delete o.yoomoney_secret_key;try{let t=await fetch("/api/admin/site-settings/payment",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)}),s=await t.json();if(!t.ok)throw Error(s.message||"Не удалось сохранить настройки.");e({title:"Настройки сохранены",description:"Настройки платежного шлюза успешно обновлены."}),s.settings?S.reset({...s.settings,yoomoney_secret_key:"",is_test_mode_active:!!s.settings.is_test_mode_active}):S.setValue("yoomoney_secret_key","")}catch(t){e({title:"Ошибка сохранения",description:t.message,variant:"destructive"})}finally{s(!1)}};return i?(0,o.jsxs)("div",{className:"flex items-center justify-center p-10",children:[(0,o.jsx)(p.A,{className:"h-8 w-8 animate-spin text-primary"}),(0,o.jsx)("p",{className:"ml-3 text-muted-foreground",children:"Загрузка настроек платежей..."})]}):(0,o.jsxs)(d.Zp,{className:"shadow-lg",children:[(0,o.jsxs)(d.aR,{children:[(0,o.jsxs)(d.ZB,{className:"text-xl font-bold text-primary flex items-center",children:[(0,o.jsx)(g.A,{className:"mr-2 h-5 w-5"}),"Настройки Платежного Шлюза"]}),(0,o.jsx)(d.BT,{className:"text-muted-foreground",children:"Управление интеграцией с YooMoney Касса и тестовым режимом."})]}),(0,o.jsx)(d.Wu,{children:(0,o.jsxs)("form",{onSubmit:S.handleSubmit(A),children:[(0,o.jsxs)(u.tU,{defaultValue:"yoomoney",className:"w-full",children:[(0,o.jsxs)(u.j7,{className:"grid w-full grid-cols-2 mb-6",children:[(0,o.jsx)(u.Xi,{value:"yoomoney",children:"YooMoney Касса"}),(0,o.jsx)(u.Xi,{value:"test_mode",children:"Тестовый Режим"})]}),(0,o.jsxs)(u.av,{value:"yoomoney",className:"space-y-6",children:[(0,o.jsx)(d.BT,{className:"text-sm text-muted-foreground mb-4",children:"Настройте интеграцию с YooMoney для приема реальных платежей."}),(0,o.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,o.jsxs)("div",{children:[(0,o.jsx)(c.Label,{htmlFor:"yoomoney_shop_id",className:"text-foreground",children:"Shop ID (Идентификатор магазина)"}),(0,o.jsx)(l.p,{id:"yoomoney_shop_id",...S.register("yoomoney_shop_id"),placeholder:"123456",className:"mt-1",disabled:t})]}),(0,o.jsxs)("div",{children:[(0,o.jsx)(c.Label,{htmlFor:"yoomoney_secret_key",className:"text-foreground",children:"Секретный ключ"}),(0,o.jsx)(l.p,{id:"yoomoney_secret_key",type:"password",...S.register("yoomoney_secret_key"),placeholder:"•••••••• (оставьте пустым, чтобы не менять)",className:"mt-1",disabled:t})]})]}),(0,o.jsxs)("div",{children:[(0,o.jsxs)(c.Label,{className:"text-foreground flex items-center",children:[(0,o.jsx)(h.A,{className:"mr-2 h-4 w-4 text-primary/80"}),"URL для HTTP-уведомлений (Webhook)"]}),(0,o.jsx)(l.p,{value:"".concat(x,"/api/payment/yoomoney-webhook"),readOnly:!0,className:"mt-1 bg-muted text-muted-foreground",disabled:t}),(0,o.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:"Скопируйте этот URL и вставьте в настройках вашего магазина YooMoney Касса."})]}),(0,o.jsx)(N.Separator,{className:"my-6"}),(0,o.jsx)("h4",{className:"text-md font-medium text-foreground",children:"Какие HTTP-уведомления от YooMoney обрабатывать:"}),(0,o.jsx)("div",{className:"space-y-3",children:w.map(e=>(0,o.jsxs)("div",{className:"flex items-start p-2.5 border border-border/30 rounded-md",children:[(0,o.jsx)(a.xI,{control:S.control,name:e.id,render:s=>{let{field:r}=s;return(0,o.jsx)(y.S,{id:e.id,checked:r.value,onCheckedChange:r.onChange,className:"mt-1 mr-3 border-primary data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground",disabled:t})}}),(0,o.jsxs)("div",{className:"grid gap-1 leading-none",children:[(0,o.jsxs)(c.Label,{htmlFor:e.id,className:"text-foreground font-medium flex items-center cursor-pointer",children:[(0,o.jsx)(e.icon,{className:"mr-2 h-4 w-4 text-primary/80"}),e.label]}),(0,o.jsxs)("p",{className:"text-xs text-muted-foreground",children:["Событие YooMoney: ",(0,o.jsx)("code",{className:"text-xs bg-muted/80 px-1 py-0.5 rounded-sm",children:e.eventName}),". ",e.description]})]})]},e.id))})]}),(0,o.jsxs)(u.av,{value:"test_mode",className:"space-y-6",children:[(0,o.jsx)(d.BT,{className:"text-sm text-muted-foreground",children:"В тестовом режиме все пополнения баланса будут создаваться как заявки, требующие ручного одобрения администратором. Реальная оплата через YooMoney производиться не будет."}),(0,o.jsxs)("div",{className:"flex items-center space-x-2 pt-2",children:[(0,o.jsx)(a.xI,{control:S.control,name:"is_test_mode_active",render:e=>{let{field:s}=e;return(0,o.jsx)(y.S,{id:"is_test_mode_active",checked:s.value,onCheckedChange:s.onChange,className:"border-primary data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground",disabled:t})}}),(0,o.jsx)(c.Label,{htmlFor:"is_test_mode_active",className:"text-lg font-medium leading-none text-foreground",children:"Включить тестовый режим платежей"})]}),S.watch("is_test_mode_active")&&(0,o.jsxs)("div",{className:"p-4 bg-yellow-500/10 border border-yellow-500/30 rounded-md",children:[(0,o.jsx)(b.A,{className:"inline h-4 w-4 mr-1.5 text-yellow-600"}),(0,o.jsx)("span",{className:"text-sm text-yellow-700",children:'Тестовый режим активен. Пополнения будут обрабатываться через заявки в разделе "Тестовые Платежи".'})]}),!S.watch("is_test_mode_active")&&(0,o.jsxs)("div",{className:"p-4 bg-green-500/10 border border-green-500/30 rounded-md",children:[(0,o.jsx)(f.A,{className:"inline h-4 w-4 mr-1.5 text-green-600"}),(0,o.jsx)("span",{className:"text-sm text-green-700",children:"Тестовый режим отключен. Платежи будут обрабатываться через YooMoney Касса."})]})]})]}),(0,o.jsx)("div",{className:"flex justify-end pt-8 border-t border-border/30 mt-8",children:(0,o.jsxs)(m.$,{type:"submit",className:"bg-primary hover:bg-primary/90 text-primary-foreground",disabled:t||i,children:[t&&(0,o.jsx)(p.A,{className:"mr-2 h-4 w-4 animate-spin"}),"Сохранить настройки платежей"]})})]})})]})}},17313:(e,t,s)=>{"use strict";s.d(t,{Xi:()=>l,av:()=>c,j7:()=>d,tU:()=>i});var o=s(95155),r=s(12115),a=s(30064),n=s(59434);let i=a.bL,d=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,o.jsx)(a.B8,{ref:t,className:(0,n.cn)("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",s),...r})});d.displayName=a.B8.displayName;let l=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,o.jsx)(a.l9,{ref:t,className:(0,n.cn)("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm",s),...r})});l.displayName=a.l9.displayName;let c=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,o.jsx)(a.UC,{ref:t,className:(0,n.cn)("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",s),...r})});c.displayName=a.UC.displayName},19037:(e,t,s)=>{Promise.resolve().then(s.bind(s,12845))},22346:(e,t,s)=>{"use strict";s.d(t,{Separator:()=>i});var o=s(95155),r=s(12115),a=s(87489),n=s(59434);let i=r.forwardRef((e,t)=>{let{className:s,orientation:r="horizontal",decorative:i=!0,...d}=e;return(0,o.jsx)(a.b,{ref:t,decorative:i,orientation:r,className:(0,n.cn)("shrink-0 bg-border","horizontal"===r?"h-[1px] w-full":"h-full w-[1px]",s),...d})});i.displayName=a.b.displayName},30285:(e,t,s)=>{"use strict";s.d(t,{$:()=>l,r:()=>d});var o=s(95155),r=s(12115),a=s(99708),n=s(74466),i=s(59434);let d=(0,n.F)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-primary bg-transparent text-primary hover:bg-primary/10 hover:text-primary/90",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),l=r.forwardRef((e,t)=>{let{className:s,variant:r,size:n,asChild:l=!1,...c}=e,m=l?a.DX:"button";return(0,o.jsx)(m,{className:(0,i.cn)(d({variant:r,size:n,className:s})),ref:t,...c})});l.displayName="Button"},47262:(e,t,s)=>{"use strict";s.d(t,{S:()=>d});var o=s(95155),r=s(12115),a=s(76981),n=s(10518),i=s(59434);let d=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,o.jsx)(a.bL,{ref:t,className:(0,i.cn)("peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground",s),...r,children:(0,o.jsx)(a.C1,{className:(0,i.cn)("flex items-center justify-center text-current"),children:(0,o.jsx)(n.A,{className:"h-4 w-4"})})})});d.displayName=a.bL.displayName},59434:(e,t,s)=>{"use strict";s.d(t,{cn:()=>a});var o=s(52596),r=s(39688);function a(){for(var e=arguments.length,t=Array(e),s=0;s<e;s++)t[s]=arguments[s];return(0,r.QP)((0,o.$)(t))}},62523:(e,t,s)=>{"use strict";s.d(t,{p:()=>n});var o=s(95155),r=s(12115),a=s(59434);let n=r.forwardRef((e,t)=>{let{className:s,type:r,...n}=e;return(0,o.jsx)("input",{type:r,className:(0,a.cn)("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",s),ref:t,...n})});n.displayName="Input"},66695:(e,t,s)=>{"use strict";s.d(t,{BT:()=>l,Wu:()=>c,ZB:()=>d,Zp:()=>n,aR:()=>i,wL:()=>m});var o=s(95155),r=s(12115),a=s(59434);let n=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,o.jsx)("div",{ref:t,className:(0,a.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",s),...r})});n.displayName="Card";let i=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,o.jsx)("div",{ref:t,className:(0,a.cn)("flex flex-col space-y-1.5 p-6",s),...r})});i.displayName="CardHeader";let d=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,o.jsx)("h3",{ref:t,className:(0,a.cn)("text-xl font-normal uppercase tracking-wider leading-none",s),...r})});d.displayName="CardTitle";let l=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,o.jsx)("p",{ref:t,className:(0,a.cn)("text-sm text-muted-foreground",s),...r})});l.displayName="CardDescription";let c=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,o.jsx)("div",{ref:t,className:(0,a.cn)("p-6 pt-0",s),...r})});c.displayName="CardContent";let m=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,o.jsx)("div",{ref:t,className:(0,a.cn)("flex items-center p-6 pt-0",s),...r})});m.displayName="CardFooter"},85057:(e,t,s)=>{"use strict";s.d(t,{Label:()=>l});var o=s(95155),r=s(12115),a=s(40968),n=s(74466),i=s(59434);let d=(0,n.F)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),l=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,o.jsx)(a.b,{ref:t,className:(0,i.cn)(d(),s),...r})});l.displayName=a.b.displayName},87481:(e,t,s)=>{"use strict";s.d(t,{dj:()=>y});var o=s(12115);let r=0,a=new Map,n=e=>{if(a.has(e))return;let t=setTimeout(()=>{a.delete(e),c({type:"REMOVE_TOAST",toastId:e})},1e6);a.set(e,t)},i=(e,t)=>{switch(t.type){case"ADD_TOAST":return{...e,toasts:[t.toast,...e.toasts].slice(0,1)};case"UPDATE_TOAST":return{...e,toasts:e.toasts.map(e=>e.id===t.toast.id?{...e,...t.toast}:e)};case"DISMISS_TOAST":{let{toastId:s}=t;return s?n(s):e.toasts.forEach(e=>{n(e.id)}),{...e,toasts:e.toasts.map(e=>e.id===s||void 0===s?{...e,open:!1}:e)}}case"REMOVE_TOAST":if(void 0===t.toastId)return{...e,toasts:[]};return{...e,toasts:e.toasts.filter(e=>e.id!==t.toastId)}}},d=[],l={toasts:[]};function c(e){l=i(l,e),d.forEach(e=>{e(l)})}function m(e){let{...t}=e,s=(r=(r+1)%Number.MAX_SAFE_INTEGER).toString(),o=()=>c({type:"DISMISS_TOAST",toastId:s});return c({type:"ADD_TOAST",toast:{...t,id:s,open:!0,onOpenChange:e=>{e||o()}}}),{id:s,dismiss:o,update:e=>c({type:"UPDATE_TOAST",toast:{...e,id:s}})}}function y(){let[e,t]=o.useState(l);return o.useEffect(()=>(d.push(t),()=>{let e=d.indexOf(t);e>-1&&d.splice(e,1)}),[e]),{...e,toast:m,dismiss:e=>c({type:"DISMISS_TOAST",toastId:e})}}}},e=>{var t=t=>e(e.s=t);e.O(0,[4277,5521,6172,8441,1684,7358],()=>t(19037)),_N_E=e.O()}]);